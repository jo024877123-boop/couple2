<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Our Story - Ïö∞Î¶¨Ïùò Ïù¥ÏïºÍ∏∞</title>
  <meta name="description" content="Ïª§ÌîåÏùò ÌñâÎ≥µÌïú ÏàúÍ∞ÑÏùÑ Í∏∞Î°ùÌïòÎäî Ïñ¥ÌîåÎ¶¨ÏºÄÏù¥ÏÖò">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Noto Sans KR', 'sans-serif'] },
          colors: {
            theme: {
              50: 'var(--primary-50)',
              100: 'var(--primary-100)',
              200: 'var(--primary-200)',
              300: 'var(--primary-300)',
              400: 'var(--primary-400)',
              500: 'var(--primary-500)',
              600: 'var(--primary-600)',
              700: 'var(--primary-700)',
            }
          }
        }
      }
    }
  </script>

  <style>
    :root {
      --primary-50: #fff1f2;
      --primary-100: #ffe4e6;
      --primary-200: #fecdd3;
      --primary-300: #fda4af;
      --primary-400: #fb7185;
      --primary-500: #f43f5e;
      --primary-600: #e11d48;
      --primary-700: #be123c;
      --bg-gradient-from: #fff1f2;
      --bg-gradient-to: #fdf2f8;
      --card-bg: rgba(255, 255, 255, 0.85);
      --glass-bg: rgba(255, 255, 255, 0.65);
      --glass-border: rgba(255, 255, 255, 0.4);
      --text-primary: #334155;
      --text-secondary: #64748b;
      --font-feature-settings: "ss01", "ss02", "ss03", "cv01", "cv02";
    }

    /* Sophisticated Theme Overrides */
    /* Theme Definitions */
    [data-theme="simple"] {
      --primary-50: #fafafa;
      --primary-100: #f5f5f5;
      --primary-200: #e5e5e5;
      --primary-300: #d4d4d4;
      --primary-400: #a3a3a3;
      --primary-500: #171717;
      /* Icons (Black) */
      --primary-600: #0a0a0a;
      --primary-700: #000000;

      --bg-gradient-from: #ffffff;
      --bg-gradient-to: #f8fafc;
      --glass-bg: rgba(255, 255, 255, 0.8);
      --glass-border: rgba(0, 0, 0, 0.08);
      --text-primary: #0f172a;
      --text-secondary: #475569;

      /* Button Styles (Medium Gray Background, Black Text for Contrast) */
      --btn-text: #000000;
      --btn-bg-from: #e5e5e5;
      --btn-bg-to: #d4d4d4;

      /* Subtle Pattern for Simple Theme */
      background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
      background-size: 24px 24px;
    }

    [data-theme="dark"] {
      --primary-50: #1e293b;
      --primary-100: #334155;
      --primary-200: #475569;
      --primary-300: #64748b;
      --primary-400: #94a3b8;
      --primary-500: #cbd5e1;
      --primary-600: #e2e8f0;
      --primary-700: #f1f5f9;

      --bg-gradient-from: #0f172a;
      --bg-gradient-to: #1e293b;
      --card-bg: rgba(30, 41, 59, 0.7);
      --glass-bg: rgba(15, 23, 42, 0.6);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;

      /* Button Styles (Slate Background, White Text) */
      --btn-text: #ffffff;
      --btn-bg-from: #475569;
      --btn-bg-to: #334155;

      /* Starry Night Pattern */
      background-image:
        radial-gradient(white, rgba(255, 255, 255, .2) 2px, transparent 3px),
        radial-gradient(white, rgba(255, 255, 255, .15) 1px, transparent 2px),
        radial-gradient(rgba(255, 255, 255, .1) 2px, transparent 2px),
        radial-gradient(rgba(75, 0, 130, 0.2) 0%, transparent 60%);
      background-size: 550px 550px, 350px 350px, 250px 250px, 100% 100%;
      background-position: 0 0, 40px 60px, 130px 270px, center;
      background-color: #0f172a;
    }

    [data-theme="cat"] {
      --primary-50: #fff0f3;
      --primary-100: #ffe3e8;
      --primary-200: #ffc9d2;
      --primary-300: #ffacb8;
      --primary-400: #ff8092;
      --primary-500: #ff4d6a;
      --primary-600: #e11d48;
      --primary-700: #be123c;

      --bg-gradient-from: #fff5f7;
      --bg-gradient-to: #ffeef2;
      --card-bg: rgba(255, 255, 255, 0.9);
      --glass-bg: rgba(255, 255, 255, 0.7);
      --glass-border: rgba(255, 182, 193, 0.3);
      --text-primary: #4a3b3b;
      --text-secondary: #7d6b6b;

      --btn-text: #881337;
      --btn-bg-from: #ffc9c9;
      --btn-bg-to: #ffaeb6;
    }

    /* Force Cursor for Everything in Cat Theme */
    /* Force Cursor for Everything in Cat Theme */
    html[data-theme="cat"],
    html[data-theme="cat"] body,
    html[data-theme="cat"] button,
    html[data-theme="cat"] a {
      /* High-Quality Sticker Style Paw Cursor */
      cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3C!-- Border/Shadow Layer --%3E%3Ccircle cx='4' cy='14' r='4.5' fill='%23ccc'/%3E%3Ccircle cx='11' cy='8' r='5' fill='%23ccc'/%3E%3Ccircle cx='21' cy='8' r='5' fill='%23ccc'/%3E%3Ccircle cx='28' cy='14' r='4.5' fill='%23ccc'/%3E%3Cellipse cx='16' cy='22' rx='11' ry='9' fill='%23ccc'/%3E%3C!-- White Base Layer --%3E%3Ccircle cx='4' cy='14' r='4' fill='white'/%3E%3Ccircle cx='11' cy='8' r='4.5' fill='white'/%3E%3Ccircle cx='21' cy='8' r='4.5' fill='white'/%3E%3Ccircle cx='28' cy='14' r='4' fill='white'/%3E%3Cellipse cx='16' cy='22' rx='10.5' ry='8.5' fill='white'/%3E%3C!-- Pink Pads Layer --%3E%3Ccircle cx='4' cy='14' r='2' fill='%23ff9eb5'/%3E%3Ccircle cx='11' cy='8' r='2.5' fill='%23ff9eb5'/%3E%3Ccircle cx='21' cy='8' r='2.5' fill='%23ff9eb5'/%3E%3Ccircle cx='28' cy='14' r='2' fill='%23ff9eb5'/%3E%3Cellipse cx='16' cy='23' rx='7' ry='5' fill='%23ff9eb5'/%3E%3C/svg%3E") 16 16, auto !important;
    }

    /* Background for Cat Theme */
    html[data-theme="cat"] body {
      background-color: #fff0f3;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 40a5 5 0 0 1 5 5v1a1 1 0 0 1-1 1h-8a1 1 0 0 1-1-1v-1a5 5 0 0 1 5-5zm-7-7a3 3 0 0 1 3 3v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-1a3 3 0 0 1 3-3zm14 0a3 3 0 0 1 3 3v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-1a3 3 0 0 1 3-3z' fill='%23ff9eb5' fill-opacity='0.15'/%3E%3C/svg%3E");
      background-size: 60px 60px;
    }

    /* Reset & Base Styles */
    body {
      background: linear-gradient(135deg, var(--bg-gradient-from, #ffffff), var(--bg-gradient-to, #f0f0f0));
      min-height: 100vh;
      color: var(--text-primary);
      letter-spacing: -0.025em;
      font-feature-settings: var(--font-feature-settings);
      -webkit-font-smoothing: antialiased;
    }

    #root,
    main {
      background-color: transparent !important;
    }

    /* Glass Effects */
    .glass {
      background: var(--glass-bg);
      backdrop-filter: blur(40px) saturate(160%);
      -webkit-backdrop-filter: blur(40px) saturate(160%);
      border: 1px solid var(--glass-border);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.01), inset 0 0 20px 5px rgba(255, 255, 255, 0.1);
    }

    .card-bg {
      background: var(--card-bg);
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.6);
      box-shadow:
        0 20px 25px -5px rgba(0, 0, 0, 0.02),
        0 8px 10px -6px rgba(0, 0, 0, 0.01);
      transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
      /* Spring-like transition */
    }

    .card-hover:hover {
      transform: translateY(-4px) scale(1.005);
      box-shadow:
        0 30px 60px -10px rgba(0, 0, 0, 0.08),
        0 15px 30px -15px rgba(0, 0, 0, 0.04);
      border-color: rgba(255, 255, 255, 0.9);
    }



    /* Mobile Calendar App Style */
    .cal-cell {
      background: transparent;
      transition: all 0.15s ease;
    }

    .cal-cell:hover {
      background: rgba(0, 0, 0, 0.05);
    }

    .cal-today-circle {
      background: #007AFF;
      color: white !important;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }

    .cal-event-dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: #007AFF;
    }

    .event-card {
      border-left: 3px solid #007AFF;
      background: #f8f9fa;
      border-radius: 0 8px 8px 0;
    }

    .event-card:hover {
      background: #f0f0f0;
    }

    /* Utility Animations */
    @keyframes float {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-8px);
      }
    }

    .animate-float {
      animation: float 4s ease-in-out infinite;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .animate-fadeIn {
      animation: fadeIn 0.3s ease-out forwards;
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .animate-scaleIn {
      animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    @keyframes slideUp {
      from {
        transform: translateY(100%);
      }

      to {
        transform: translateY(0);
      }
    }

    .animate-slideUp {
      animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    /* Spring Animations */
    @keyframes spring-up {
      0% {
        transform: translateY(20px);
        opacity: 0;
      }

      50% {
        transform: translateY(-5px);
        opacity: 1;
      }

      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .animate-fadeInUp {
      animation: spring-up 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    .btn-bounce {
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .btn-bounce:active {
      transform: scale(0.92);
    }

    /* Scrollbar refinements */
    ::-webkit-scrollbar {
      width: 4px;
    }

    ::-webkit-scrollbar-thumb {
      border-radius: 4px;
      background: rgba(0, 0, 0, 0.1);
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }
  </style>
</head>

<body class="font-sans antialiased">
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;

    const THEMES = [
      { id: 'simple', name: 'Simple', color: '#171717', emoji: 'üñ§' },
      { id: 'dark', name: 'Dark', color: '#1e293b', emoji: 'üåô' },
      { id: 'cat', name: 'Cat', color: '#ff6b7e', emoji: 'üê±' },
    ];

    // Cat Theme Click Interaction
    const useCatEffect = (theme) => {
      useEffect(() => {
        if (theme !== 'cat') return;

        const handleClick = (e) => {
          const paw = document.createElement('div');
          paw.innerHTML = 'üêæ';
          paw.style.position = 'fixed';
          paw.style.left = `${e.clientX}px`;
          paw.style.top = `${e.clientY}px`;
          paw.style.transform = 'translate(-50%, -50%) scale(0.5)';
          paw.style.pointerEvents = 'none';
          paw.style.fontSize = '24px';
          paw.style.opacity = '1';
          paw.style.transition = 'all 0.8s ease-out';
          paw.style.zIndex = '9999';
          document.body.appendChild(paw);

          // Random Meow Text occasionally
          if (Math.random() > 0.7) {
            const meow = document.createElement('div');
            const meows = ['ÏïºÏòπ!', 'Meow', 'Í≥®Í≥®..', 'ÍæπÍæπ'];
            meow.innerText = meows[Math.floor(Math.random() * meows.length)];
            meow.style.position = 'fixed';
            meow.style.left = `${e.clientX + 20}px`;
            meow.style.top = `${e.clientY - 20}px`;
            meow.style.fontSize = '14px';
            meow.style.fontWeight = 'bold';
            meow.style.color = '#ff6b7e';
            meow.style.pointerEvents = 'none';
            meow.style.animation = 'float 1s ease-out forwards';
            meow.style.zIndex = '9999';
            document.body.appendChild(meow);
            setTimeout(() => meow.remove(), 1000);
          }

          requestAnimationFrame(() => {
            paw.style.transform = `translate(-50%, -50%) scale(1.2) rotate(${Math.random() * 40 - 20}deg)`;
            paw.style.opacity = '0';
            paw.style.top = `${e.clientY - 50}px`;
          });

          setTimeout(() => paw.remove(), 800);
        };

        window.addEventListener('click', handleClick);
        return () => window.removeEventListener('click', handleClick);
      }, [theme]);
    };



    const Icon = ({ name, size = 20, className = "", fill = false }) => {
      const ref = useRef(null);

      // Get current theme from body attribute (workaround since Icon is outside main App context often)
      const isCatTheme = document.documentElement.getAttribute('data-theme') === 'cat';

      // Cat Theme Icon Mapping
      const getCatIcon = (originalName) => {
        const map = {
          'layout-grid': 'paw-print',
          'image': 'cat',
          'check-square': 'fish',
          'star': 'sparkles',
          'calendar-days': 'calendar-heart', // calendar-heart isn't standard lucide, fallback logic needed if not exists
          'plus': 'plus-circle',
          'settings': 'settings-2',
          'heart': 'heart-handshake'
        };
        // Use mapped icon if exists, otherwise keep original
        return map[originalName] || originalName;
      };

      const finalName = isCatTheme ? getCatIcon(name) : name;

      useEffect(() => {
        // ÏºÄÎ∞• ÏºÄÏù¥Ïä§Î•º ÌååÏä§Ïπº ÏºÄÏù¥Ïä§Î°ú Î≥ÄÌôò
        const pascalName = finalName
          .split('-')
          .map(part => part.charAt(0).toUpperCase() + part.slice(1))
          .join('');

        // Fallback to original if cat icon not found in Lucide
        let iconData = lucide.icons[finalName] || lucide.icons[pascalName];
        if (!iconData && isCatTheme) {
          const originalPascal = name.split('-').map(p => p.charAt(0).toUpperCase() + p.slice(1)).join('');
          iconData = lucide.icons[name] || lucide.icons[originalPascal];
        }

        if (ref.current && iconData) {
          ref.current.innerHTML = '';
          const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          svg.setAttribute('width', size);
          svg.setAttribute('height', size);
          svg.setAttribute('viewBox', '0 0 24 24');
          svg.setAttribute('fill', fill ? 'currentColor' : 'none');
          svg.setAttribute('stroke', 'currentColor');
          svg.setAttribute('stroke-width', '1.5');
          svg.setAttribute('stroke-linecap', 'round');
          svg.setAttribute('stroke-linejoin', 'round');

          if (Array.isArray(iconData)) {
            iconData.forEach(([tag, attrs]) => {
              const element = document.createElementNS('http://www.w3.org/2000/svg', tag);
              Object.entries(attrs).forEach(([key, value]) => {
                element.setAttribute(key, value);
              });
              svg.appendChild(element);
            });
          }

          ref.current.appendChild(svg);
        }
      }, [finalName, size, fill, isCatTheme]); // Re-render when theme changes (effectively via re-mount or checking attribute)

      return <span ref={ref} className={`inline-flex items-center justify-center ${className}`} />;
    };

    const MOOD_OPTIONS = [
      { id: 'happy', icon: 'smile', label: 'ÌñâÎ≥µ', color: 'text-yellow-500', bg: 'bg-yellow-50' },
      { id: 'neutral', icon: 'meh', label: 'Í∑∏Ï†ÄÍ∑∏Îüº', color: 'text-gray-500', bg: 'bg-gray-50' },
      { id: 'fun', icon: 'laugh', label: 'Ï¶êÍ±∞ÏõÄ', color: 'text-pink-500', bg: 'bg-pink-50' },
      { id: 'love', icon: 'heart', label: 'ÏÇ¨ÎûëÏä§Îü¨ÏõÄ', color: 'text-red-500', bg: 'bg-red-50' },
      { id: 'angry', icon: 'frown', label: 'ÌôîÎÇ®', color: 'text-orange-600', bg: 'bg-orange-50' },
      { id: 'gloom', icon: 'cloud-rain', label: 'Ïö∞Ïö∏', color: 'text-blue-500', bg: 'bg-blue-50' },
      { id: 'sad', icon: 'droplet', label: 'Ïä¨Ìîî', color: 'text-indigo-500', bg: 'bg-indigo-50' },
      { id: 'lucky', icon: 'sparkles', label: 'ÌñâÏö¥', color: 'text-emerald-500', bg: 'bg-emerald-50' },
    ];

    const SAMPLE_POSTS = [
      {
        id: '1', content: 'Ï≤´ Îç∞Ïù¥Ìä∏ ÎÇ†, Í∞ôÏù¥ ÏÇ∞Ï±ÖÌïòÎ©¥ÏÑú Ïª§Ìîº ÎßàÏÖ®Îçò Í∑∏ ÏàúÍ∞ÑÏù¥ ÏïÑÏßÅÎèÑ ÏÉùÏÉùÌï¥Ïöî. üíó',
        location: 'ÌïúÍ∞ïÍ≥µÏõê',
        media: [
          { url: 'https://images.unsplash.com/photo-1518199266791-5375a83190b7?w=800', type: 'image' },
          { url: 'https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?w=800', type: 'image' },
        ],
        thumbnailIndex: 0, mood: 'love', date: '2025-11-15', author: 'me',
      },
      {
        id: '2', content: 'Í∞ôÏù¥ Î≥∏ ÏòÅÌôî ÎÑàÎ¨¥ Ïû¨Î∞åÏóàÏñ¥! ÌåùÏΩòÎèÑ ÎßõÏûàÏóàÍ≥† üòä',
        location: 'CGV Í∞ïÎÇ®',
        media: [{ url: 'https://images.unsplash.com/photo-1517604931442-7e0c8ed2963c?w=800', type: 'image' }],
        thumbnailIndex: 0, mood: 'happy', date: '2025-12-24', author: 'partner',
      },
      {
        id: '3', content: 'Ïö∞Î¶¨ 100Ïùº Í∏∞ÎÖê Ï†úÏ£ºÎèÑ Ïó¨Ìñâ! Î∞îÎã§Í∞Ä ÎÑàÎ¨¥ ÏòàÎª§Ïñ¥ üåä',
        location: 'Ï†úÏ£ºÎèÑ ÌòëÏû¨Ìï¥Î≥Ä',
        media: [
          { url: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800', type: 'image' },
          { url: 'https://images.unsplash.com/photo-1559494007-9f5847c49d94?w=800', type: 'image' },
          { url: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800', type: 'image' },
        ],
        thumbnailIndex: 0, mood: 'excited', date: '2026-01-10', author: 'me',
      }
    ];

    // Ïã¨ÌîåÌïòÍ≥† ÏÑ∏Î†®Îêú Î°úÍ≥† (Intertwined Lines Ïª®ÏÖâ)
    const Logo = ({ size = 40, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 100 100" className={`text-theme-500 fill-none stroke-current ${className}`} xmlns="http://www.w3.org/2000/svg">
        {/* Intertwined Lines: Ï∂îÏÉÅÏ†ÅÏù∏ Îëê ÏÇ¨ÎûåÏùò Ïù∏Ïó∞ */}
        <path d="M30 40 C30 10, 70 10, 70 40 C70 70, 30 70, 30 40 Z" strokeWidth="4.5" className="animate-float" style={{ animationDelay: '0s' }} />
        <path d="M70 60 C70 90, 30 90, 30 60 C30 30, 70 30, 70 60 Z" strokeWidth="4.5" className="animate-float" style={{ animationDelay: '1.5s' }} />
        <circle cx="50" cy="50" r="3" fill="currentColor" className="animate-pulse" />
      </svg>
    );

    const App = () => {
      const [settings, setSettings] = useState(() => {
        const saved = localStorage.getItem('coupleAppConfig');
        const defaults = {
          coupleName: 'Ïö∞Î¶¨', anniversaryDate: '2025-01-01', myName: 'ÎÇò', partnerName: 'ÎãπÏã†', theme: 'simple', appTitle: 'Our Story', appSubtitle: 'Ïö∞Î¶¨Ïùò Ïù¥ÏïºÍ∏∞',
          customTabs: { feed: 'Timeline', gallery: 'Gallery', checklist: 'Checklist', bucket: 'Bucket List', calendar: 'Anniversary' },
          customHeaders: { feed: 'Ïö∞Î¶¨Ïùò Î™®Îì† ÏàúÍ∞Ñ', gallery: 'Ï∂îÏñµ Ï†ÄÏû•ÏÜå', checklist: 'Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏', bucket: 'Î≤ÑÌÇ∑Î¶¨Ïä§Ìä∏', calendar: 'Ïö∞Î¶¨Ïùò Í∏∞ÎÖêÏùº' },
          customIcons: { feed: 'üìñ', gallery: 'üñºÔ∏è', checklist: '‚úÖ', bucket: '‚≠ê', calendar: 'üìÖ' },
          adminPassword: '11' // Ï¥àÍ∏∞ ÎπÑÎ∞ÄÎ≤àÌò∏ ÏÑ§Ï†ï (ÌïÑÏöîÏãú)
        };
        if (saved) {
          const parsed = JSON.parse(saved);
          // ÍπäÏùÄ Î≥ëÌï© ÏóÜÏù¥ 1Îã®Í≥Ñ Î≥ëÌï© + ÎàÑÎùΩÎêú Í∞ùÏ≤¥ ÌïÑÎìú Î≥¥Í∞ï
          return {
            ...defaults,
            ...parsed,
            customTabs: { ...defaults.customTabs, ...(parsed.customTabs || {}) },
            customHeaders: { ...defaults.customHeaders, ...(parsed.customHeaders || {}) },
            customIcons: { ...defaults.customIcons, ...(parsed.customIcons || {}) }
          };
        }
        return defaults;
      });

      const [posts, setPosts] = useState(() => {
        const saved = localStorage.getItem('coupleAppPosts');
        return saved ? JSON.parse(saved) : SAMPLE_POSTS;
      });

      const [activeTab, setActiveTabState] = useState('feed');
      const [direction, setDirection] = useState('right');
      const tabOrder = ['feed', 'gallery', 'checklist', 'bucket', 'calendar'];

      const setActiveTab = (newTab) => {
        const currentIndex = tabOrder.indexOf(activeTab);
        const newIndex = tabOrder.indexOf(newTab);
        setDirection(newIndex > currentIndex ? 'right' : 'left');
        setActiveTabState(newTab);
      };

      // Wrap interactions without sound
      const handleModalOpen = () => { setIsModalOpen(true); };
      const handleThemePicker = () => { setIsThemePickerOpen(true); };
      const handleSettingsOpen = () => { setIsSettingsOpen(true); };

      const [isModalOpen, setIsModalOpen] = useState(false);
      const [isSettingsOpen, setIsSettingsOpen] = useState(false);
      const [editingPost, setEditingPost] = useState(null);
      const [selectedPost, setSelectedPost] = useState(null);
      const [deleteConfirm, setDeleteConfirm] = useState(null);
      const [isThemePickerOpen, setIsThemePickerOpen] = useState(false);
      const [isAdminOpen, setIsAdminOpen] = useState(false);
      const [isEditMode, setIsEditMode] = useState(false);
      const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false);
      const [isScrolled, setIsScrolled] = useState(false);

      // Apply Cat Theme Effect
      useCatEffect(settings.theme);

      const [newPost, setNewPost] = useState({
        content: '', location: '', media: [], thumbnailIndex: 0,
        mood: 'happy', date: new Date().toISOString().split('T')[0]
      });

      // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏÉÅÌÉú
      // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏÉÅÌÉú
      const [checklistGroups, setChecklistGroups] = useState(() => {
        const saved = localStorage.getItem('coupleAppChecklistGroups');
        return saved ? JSON.parse(saved) : [{ id: 'default', name: 'Í∏∞Î≥∏ Í∑∏Î£π' }];
      });
      const [selectedGroupId, setSelectedGroupId] = useState('default');
      const [checklist, setChecklist] = useState(() => {
        const saved = localStorage.getItem('coupleAppChecklistV2');
        return saved ? JSON.parse(saved) : [
          { id: '1', text: 'Ìï®Íªò ÏùºÏ∂ú Î≥¥Í∏∞', checked: false, groupId: 'default' },
          { id: '2', text: 'Ïª§Ìîå ÏöîÎ¶¨ Ìï¥Î≥¥Í∏∞', checked: true, groupId: 'default' },
        ];
      });
      const [newCheckItem, setNewCheckItem] = useState('');
      const [newGroupName, setNewGroupName] = useState('');
      const [checklistEditMode, setChecklistEditMode] = useState(false);
      const [editingGroupId, setEditingGroupId] = useState(null);
      const [editingGroupName, setEditingGroupName] = useState('');
      const [groupToDelete, setGroupToDelete] = useState(null);

      useEffect(() => { localStorage.setItem('coupleAppChecklistGroups', JSON.stringify(checklistGroups)); }, [checklistGroups]);
      useEffect(() => { localStorage.setItem('coupleAppChecklistV2', JSON.stringify(checklist)); }, [checklist]);

      // Î≤ÑÌÇ∑Î¶¨Ïä§Ìä∏ ÏÉÅÌÉú
      const [bucketList, setBucketList] = useState(() => {
        const saved = localStorage.getItem('coupleAppBucketList');
        return saved ? JSON.parse(saved) : [
          { id: '1', text: 'Ìï®Íªò Ìï¥Ïô∏Ïó¨Ìñâ Í∞ÄÍ∏∞', checked: false, emoji: '‚úàÔ∏è' },
          { id: '2', text: 'Î∞òÎ†§ÎèôÎ¨º ÌÇ§Ïö∞Í∏∞', checked: false, emoji: 'üê∂' },
          { id: '3', text: 'Î≥Ñ Î≥¥Îü¨ Ï∫†ÌïëÍ∞ÄÍ∏∞', checked: true, emoji: '‚≠ê' },
        ];
      });
      const [newBucketItem, setNewBucketItem] = useState('');

      useEffect(() => {
        document.documentElement.setAttribute('data-theme', settings.theme === 'rose' ? '' : settings.theme);
      }, [settings.theme]);

      // Ìôà ÏúÑÏ†Ø ÏÉÅÌÉú (D-Day Î∞∞Í≤Ω, ÏÉÅÌÉú Î©îÏãúÏßÄ)
      const [dDayImage, setDDayImage] = useState(() => localStorage.getItem('coupleAppDDayImage') || null);
      const [statusMessage, setStatusMessage] = useState(() => {
        const saved = localStorage.getItem('coupleAppStatusMessage');
        return saved ? JSON.parse(saved) : { my: 'Ïò§Îäò Í∏∞Î∂Ñ Ïñ¥ÎïåÏöî?', partner: 'Î≥¥Í≥† Ïã∂Ïñ¥Ïöî üíï' };
      });
      const [isDateRecommendOpen, setIsDateRecommendOpen] = useState(false);
      const [recommendedDate, setRecommendedDate] = useState(null);
      const [galleryMode, setGalleryMode] = useState('grid'); // 'grid' or 'polaroid'

      useEffect(() => { localStorage.setItem('coupleAppDDayImage', dDayImage || ''); }, [dDayImage]);
      useEffect(() => { localStorage.setItem('coupleAppStatusMessage', JSON.stringify(statusMessage)); }, [statusMessage]);

      const DATE_COURSES = [
        { title: 'ÌïúÍ∞ï ÏπòÎß• & ÏÇ∞Ï±Ö', icon: 'beer' }, { title: 'Í≥µÎ∞©ÏóêÏÑú Ïª§ÌîåÌÖú ÎßåÎì§Í∏∞', icon: 'hammer' },
        { title: 'Îî∞ÎúªÌïú ÏßëÏóêÏÑú ÎÑ∑ÌîåÎ¶≠Ïä§', icon: 'tv' }, { title: 'Î∂ÑÏúÑÍ∏∞ Ï¢ãÏùÄ ÏôÄÏù∏Î∞î', icon: 'wine' },
        { title: 'ÎèôÎÑ§ ÎßõÏßë ÌÉêÎ∞©', icon: 'utensils' }, { title: 'ÍµêÎ≥µ ÏûÖÍ≥† ÎÜÄÏù¥Í≥µÏõê', icon: 'ticket' },
        { title: 'Ï†ÑÏãúÌöå Í¥ÄÎûåÎ°ú Í∞êÏÑ± Ï∂©Ï†Ñ', icon: 'image' }, { title: 'Î≥ºÎßÅ/Ìè¨ÏºìÎ≥º ÎÇ¥Í∏∞', icon: 'trophy' },
        { title: 'ÎßåÌôîÏπ¥ÌéòÏóêÏÑú ÎíπÍµ¥Í±∞Î¶¨Í∏∞', icon: 'book-open' }, { title: 'Í∑ºÍµê ÎìúÎùºÏù¥Î∏å & Ïπ¥Ìéò', icon: 'car' }
      ];

      const recommendDate = () => {
        const random = DATE_COURSES[Math.floor(Math.random() * DATE_COURSES.length)];
        setRecommendedDate(random);
        setIsDateRecommendOpen(true);
      };

      useEffect(() => { localStorage.setItem('coupleAppSettings', JSON.stringify(settings)); }, [settings]);
      useEffect(() => { localStorage.setItem('coupleAppPosts', JSON.stringify(posts)); }, [posts]);
      useEffect(() => { localStorage.setItem('coupleAppPosts', JSON.stringify(posts)); }, [posts]);
      useEffect(() => { localStorage.setItem('coupleAppBucketList', JSON.stringify(bucketList)); }, [bucketList]);

      // Calendar Notes State
      const [calendarNotes, setCalendarNotes] = useState(() => {
        const saved = localStorage.getItem('coupleAppCalendarNotes');
        return saved ? JSON.parse(saved) : {};
      });
      useEffect(() => { localStorage.setItem('coupleAppCalendarNotes', JSON.stringify(calendarNotes)); }, [calendarNotes]);

      useEffect(() => {
        const handleScroll = () => setIsScrolled(window.scrollY > 20);
        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
      }, []);

      const dDay = useMemo(() => {
        const diff = Math.abs(new Date() - new Date(settings.anniversaryDate));
        return Math.ceil(diff / (1000 * 60 * 60 * 24));
      }, [settings.anniversaryDate]);

      const handleAddPost = (e) => {
        e.preventDefault();
        if (!newPost.content.trim()) return;
        const post = {
          id: Date.now().toString(), ...newPost,
          media: newPost.media.length ? newPost.media : [{ url: 'https://images.unsplash.com/photo-1518199266791-5375a83190b7?w=800', type: 'image' }],
          author: 'me',
        };
        setPosts(prev => [post, ...prev]);
        resetForm();
        setIsModalOpen(false);
      };

      const handleEditPost = (e) => {
        e.preventDefault();
        if (!editingPost) return;
        setPosts(prev => prev.map(p => p.id === editingPost.id ? editingPost : p));
        setEditingPost(null);
      };

      const handleDeletePost = (id) => {
        setPosts(prev => prev.filter(p => p.id !== id));
        setDeleteConfirm(null);
        setSelectedPost(null);
      };

      const resetForm = () => {
        setNewPost({ content: '', location: '', media: [], thumbnailIndex: 0, mood: 'happy', date: new Date().toISOString().split('T')[0] });
      };

      const getMoodInfo = (moodId) => MOOD_OPTIONS.find(m => m.id === moodId) || MOOD_OPTIONS[0];

      const handleDDayImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => setDDayImage(e.target.result);
          reader.readAsDataURL(file);
        }
      };

      return (
        <div className="min-h-screen text-primary">

          {/* ÏÇ¨Ïù¥ÎìúÎ∞î */}
          {/* ÏÇ¨Ïù¥ÎìúÎ∞î (Îç∞Ïä§ÌÅ¨ÌÉë) */}
          <aside className={`hidden lg:flex fixed left-0 top-0 bottom-0 ${isSidebarCollapsed ? 'w-20' : 'w-72'} glass border-r border-theme-100 flex-col transition-all duration-300 z-30`}>
            {/* ÌÜ†Í∏Ä Î≤ÑÌäº */}
            <button
              onClick={() => setIsSidebarCollapsed(!isSidebarCollapsed)}
              className="absolute -right-3 top-9 w-6 h-6 bg-white border border-theme-100 rounded-full flex items-center justify-center shadow-md text-secondary hover:text-theme-500 transition-all z-40 hover:scale-110"
            >
              <Icon name={isSidebarCollapsed ? 'chevron-right' : 'chevron-left'} size={14} />
            </button>

            <div className={`p-6 mb-2 flex items-center ${isSidebarCollapsed ? 'justify-center' : 'gap-4'} transition-all`}>
              <div className="shrink-0 cursor-pointer" onClick={() => setActiveTab('feed')}>
                <Logo size={40} className="hover:scale-110 transition-transform duration-500" />
              </div>
              {!isSidebarCollapsed && (
                <div className="overflow-hidden whitespace-nowrap animate-fadeIn">
                  <span className="font-black text-xl text-primary block truncate transition-colors duration-300">{settings.appTitle || 'Our Story'}</span>
                  <p className="text-xs text-secondary font-medium truncate">{settings.appSubtitle || 'Ïö∞Î¶¨Ïùò Ïù¥ÏïºÍ∏∞'}</p>
                </div>
              )}
            </div>

            <nav className="flex-1 px-3 space-y-2 overflow-y-auto scrollbar-hide">
              {[
                { id: 'feed', icon: 'layout-grid', label: 'ÌÉÄÏûÑÎùºÏù∏' },
                { id: 'gallery', icon: 'image', label: 'Í∞§Îü¨Î¶¨' },
                { id: 'checklist', icon: 'check-square', label: 'Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏' },
                { id: 'bucket', icon: 'star', label: 'Î≤ÑÌÇ∑Î¶¨Ïä§Ìä∏' },
                { id: 'calendar', icon: 'calendar-days', label: 'Í∏∞ÎÖêÏùº' },
              ].map(tab => (
                <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                  className={`w-full flex items-center ${isSidebarCollapsed ? 'justify-center px-0' : 'px-4 gap-4'} py-3.5 rounded-2xl font-semibold transition-all btn-bounce ${activeTab === tab.id ? 'bg-theme-100 text-theme-600 shadow-sm' : 'text-secondary hover:bg-theme-50'
                    }`} title={isSidebarCollapsed ? tab.label : ''}>
                  <Icon name={tab.icon} size={22} className={activeTab === tab.id ? 'text-theme-500' : ''} />
                  {!isSidebarCollapsed && <span>{settings.customTabs ? settings.customTabs[tab.id] : tab.label}</span>}
                  {!isSidebarCollapsed && activeTab === tab.id && <div className="ml-auto w-1.5 h-1.5 bg-theme-500 rounded-full" />}
                </button>
              ))}
            </nav>

            {!isSidebarCollapsed ? (
              <div className="relative overflow-hidden p-4 mx-2 mt-auto mb-4 bg-gradient-to-br from-theme-50 to-pink-50 rounded-3xl border border-theme-100 animate-fadeInUp group shadow-sm transition-all hover:shadow-md">
                {dDayImage && (
                  <>
                    <img src={dDayImage} className="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" alt="" />
                    <div className="absolute inset-0 bg-black/30 group-hover:bg-black/40 transition-colors" />
                  </>
                )}
                <div className="relative z-10 flex flex-col">
                  <div className="flex items-center gap-2 mb-2">
                    <span className="text-2xl animate-bounce-slow drop-shadow-md">üíï</span>
                    <p className={`text-xs font-bold uppercase tracking-wider ${dDayImage ? 'text-white/90 drop-shadow-sm' : 'text-theme-500'}`}>Ìï®ÍªòÌïú ÏßÄ</p>
                  </div>
                  <p className={`text-3xl font-black tracking-tight ${dDayImage ? 'text-white drop-shadow-md' : 'text-theme-600'}`}>
                    {dDay}<span className={`text-sm font-medium ml-1 ${dDayImage ? 'text-white/80' : 'text-theme-400'}`}>days</span>
                  </p>
                </div>
                <div className="absolute top-2 right-2 flex gap-1 z-20 opacity-30 hover:opacity-100 transition-opacity duration-200">
                  {dDayImage && (
                    <button
                      onClick={(e) => { e.stopPropagation(); setDDayImage(null); }}
                      className="p-1.5 bg-black/20 hover:bg-black/50 backdrop-blur-md rounded-full text-white transition-all btn-bounce"
                      title="Î∞∞Í≤Ω ÏÇ≠Ï†ú"
                    >
                      <Icon name="x" size={12} />
                    </button>
                  )}
                  <label className="p-1.5 bg-black/20 hover:bg-black/50 backdrop-blur-md rounded-full text-white cursor-pointer transition-all btn-bounce" title="Î∞∞Í≤Ω ÏÇ¨ÏßÑ Î≥ÄÍ≤Ω">
                    <Icon name="camera" size={12} />
                    <input type="file" accept="image/*" className="hidden" onChange={handleDDayImageUpload} />
                  </label>
                </div>
              </div>
            ) : (
              <div className="mt-auto mb-6 flex flex-col items-center gap-1 animate-fadeIn">
                <span className="text-xl">üíï</span>
                <span className="text-xs font-bold text-theme-500">{dDay}</span>
              </div>
            )}

            <div className={`p-4 ${isSidebarCollapsed ? 'flex-col gap-4 items-center' : 'flex gap-2'}`}>
              <button onClick={handleThemePicker} className={`flex items-center justify-center ${isSidebarCollapsed ? 'w-10 h-10 rounded-full' : 'flex-1 px-4 py-3 rounded-xl'} text-secondary hover:text-theme-500 hover:bg-theme-50 transition-all btn-bounce`}>
                <Icon name="palette" size={20} />
                {!isSidebarCollapsed && <span className="text-sm font-medium ml-2">ÌÖåÎßà</span>}
              </button>
              <button onClick={handleSettingsOpen} className={`flex items-center justify-center ${isSidebarCollapsed ? 'w-10 h-10 rounded-full' : 'flex-1 px-4 py-3 rounded-xl'} text-secondary hover:text-theme-500 hover:bg-theme-50 transition-all btn-bounce`}>
                <Icon name="settings" size={20} />
                {!isSidebarCollapsed && <span className="text-sm font-medium ml-2">ÏÑ§Ï†ï</span>}
              </button>
            </div>
          </aside>

          {/* Î™®Î∞îÏùº Ìó§Îçî */}
          <header className={`lg:hidden sticky top-0 border-b border-theme-100 z-30 px-5 transition-all duration-300 flex justify-between items-center ${isScrolled ? 'py-3 bg-white/90 backdrop-blur-md shadow-sm' : 'py-5 bg-transparent backdrop-blur-sm'}`}>
            <div className={`flex items-center gap-3 transition-transform duration-300 ${isScrolled ? 'scale-90 origin-left' : 'scale-100'}`}>
              <Logo size={isScrolled ? 32 : 40} />
              <span className="font-black text-lg bg-gradient-to-r from-theme-500 to-pink-500 bg-clip-text text-transparent">{settings.appTitle || 'Our Story'}</span>
            </div>
            <div className="flex items-center gap-2">
              <div className="bg-gradient-to-r from-pink-500 to-rose-500 text-white text-xs font-bold px-3 py-1.5 rounded-full shadow-sm">D+{dDay}</div>
              <button onClick={handleThemePicker} className="p-2 text-secondary hover:text-theme-500 transition-colors"><Icon name="palette" size={20} /></button>
              <button onClick={handleSettingsOpen} className="p-2 text-secondary hover:text-theme-500 transition-colors"><Icon name="settings" size={20} /></button>
            </div>
          </header>

          {/* Î©îÏù∏ */}
          <main className={`${isSidebarCollapsed ? 'lg:pl-20' : 'lg:pl-72'} min-h-screen transition-all duration-300`}>
            {/* Îç∞Ïä§ÌÅ¨ÌÉë ÌÉëÎ∞î (Floating Style with Scroll Effect) */}
            <div className={`hidden lg:flex sticky top-6 z-20 mx-6 mb-6 px-6 ${isScrolled ? 'py-2.5 scale-[0.98] bg-white/60 shadow-md backdrop-blur-2xl' : 'py-4 bg-white/40 shadow-sm backdrop-blur-md'} rounded-2xl border border-white/20 items-center justify-between transition-all duration-500 ease-[cubic-bezier(0.32,0.72,0,1)] hover:shadow-lg hover:scale-[0.99]`}>
              <div className="flex items-center gap-3">
                <div className={`p-2 bg-theme-50/50 rounded-xl text-theme-500 transition-all duration-300 ${isScrolled ? 'scale-90' : ''}`}>
                  <Icon name={
                    activeTab === 'feed' ? 'layout-grid' :
                      activeTab === 'gallery' ? 'image' :
                        activeTab === 'checklist' ? 'check-square' :
                          activeTab === 'bucket' ? 'star' : 'calendar-days'
                  } size={isScrolled ? 18 : 20} />
                </div>
                <span className={`font-bold text-primary tracking-tight transition-all duration-300 ${isScrolled ? 'text-base' : 'text-lg'}`}>{
                  settings.customTabs ? settings.customTabs[activeTab] : (activeTab === 'feed' ? 'Timeline' :
                    activeTab === 'gallery' ? 'Gallery' :
                      activeTab === 'checklist' ? 'Checklist' :
                        activeTab === 'bucket' ? 'Bucket List' : 'Anniversary')
                }</span>
              </div>
              <div className="flex items-center gap-2">
                <button onClick={() => setIsAdminOpen(true)} className="w-8 h-8 flex items-center justify-center hover:bg-theme-50 rounded-full text-secondary hover:text-primary transition-colors" title="Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï">
                  <Icon name="wrench" size={14} />
                </button>
                <button onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })} className="w-10 h-10 flex items-center justify-center hover:bg-theme-50 rounded-full btn-bounce text-secondary hover:text-primary transition-colors">
                  <Icon name="arrow-up" size={20} />
                </button>
              </div>
            </div>
            <div className={`max-w-4xl mx-auto px-5 py-8 lg:py-12 pb-32 ${direction === 'right' ? 'animate-slideInRight' : 'animate-slideInLeft'}`} key={activeTab}>

              <div className="flex items-center justify-between mb-8">
                <div className="flex items-center gap-3">
                  <span className="text-3xl">{settings.customIcons ? settings.customIcons[activeTab] : (activeTab === 'feed' ? 'üìñ' : activeTab === 'gallery' ? 'üñºÔ∏è' : 'üìÖ')}</span>
                  <div>
                    <h2 className="text-2xl lg:text-3xl font-black text-primary">
                      {settings.customHeaders ? settings.customHeaders[activeTab] : (
                        activeTab === 'feed' ? 'Ïö∞Î¶¨Ïùò Î™®Îì† ÏàúÍ∞Ñ' : activeTab === 'gallery' ? 'Ï∂îÏñµ Ï†ÄÏû•ÏÜå' : 'Ïö∞Î¶¨Ïùò Í∏∞ÎÖêÏùº'
                      )}
                    </h2>
                    <p className="text-secondary text-sm font-medium mt-1">{posts.length}Í∞úÏùò ÏÜåÏ§ëÌïú Í∏∞Ïñµ</p>
                  </div>
                </div>
                {activeTab === 'feed' && (
                  <button onClick={() => setIsEditMode(!isEditMode)}
                    className={`px-4 py-2 rounded-xl font-medium text-sm btn-bounce flex items-center gap-2 ${isEditMode ? 'bg-theme-500 text-white' : 'bg-theme-50 text-theme-600'
                      }`}>
                    <Icon name={isEditMode ? 'check' : 'pencil'} size={16} />
                    {isEditMode ? 'ÏôÑÎ£å' : 'Ìé∏Ïßë'}
                  </button>
                )}
                {activeTab === 'gallery' && (
                  <div className="flex bg-theme-50 p-1 rounded-xl gap-1">
                    <button onClick={() => setGalleryMode('grid')} className={`p-2 rounded-lg transition-all ${galleryMode === 'grid' ? 'bg-white text-theme-500 shadow-sm' : 'text-secondary hover:text-theme-500'}`}>
                      <Icon name="layout-grid" size={18} />
                    </button>
                    <button onClick={() => setGalleryMode('polaroid')} className={`p-2 rounded-lg transition-all ${galleryMode === 'polaroid' ? 'bg-white text-theme-500 shadow-sm' : 'text-secondary hover:text-theme-500'}`}>
                      <Icon name="image" size={18} />
                    </button>
                  </div>
                )}
              </div>


              {/* ÌîºÎìú */}
              {activeTab === 'feed' && (
                <div className="space-y-6">
                  {posts.length === 0 ? (
                    <EmptyState onAdd={() => setIsModalOpen(true)} />
                  ) : (
                    posts.sort((a, b) => new Date(b.date) - new Date(a.date)).map((post, i) => (
                      <div key={post.id} className="animate-fadeInUp" style={{ animationDelay: `${i * 0.08}s` }}>
                        <PostCard
                          post={post} settings={settings} getMoodInfo={getMoodInfo}
                          onClick={() => setSelectedPost(post)}
                          isEditMode={isEditMode}
                          onEdit={() => setEditingPost({ ...post })}
                          onDelete={() => setDeleteConfirm(post.id)}
                        />
                      </div>
                    ))
                  )}
                </div>
              )}

              {/* Í∞§Îü¨Î¶¨ */}
              {activeTab === 'gallery' && (
                galleryMode === 'grid' ? (
                  <div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
                    {posts.flatMap(post => post.media.map((m, idx) => ({ ...m, postId: post.id, post, idx }))).map((item, i) => (
                      <div key={`${item.postId}-${item.idx}`}
                        className="aspect-square rounded-3xl overflow-hidden shadow-md card-hover cursor-pointer group animate-fadeInUp relative"
                        style={{ animationDelay: `${i * 0.05}s` }}
                        onClick={() => setSelectedPost({ ...item.post, initialIndex: item.idx })}>
                        {item.type === 'video' ? (
                          <video src={item.url} className="w-full h-full object-cover" muted />
                        ) : (
                          <img src={item.url} className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" alt="" />
                        )}
                        <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                          <div className="absolute bottom-3 left-3 right-3">
                            <p className="text-white text-sm font-medium line-clamp-1">{item.post.location}</p>
                          </div>
                        </div>
                        {item.type === 'video' && (
                          <div className="absolute inset-0 flex items-center justify-center">
                            <div className="w-12 h-12 bg-white/30 backdrop-blur rounded-full flex items-center justify-center">
                              <Icon name="play" size={24} className="text-white ml-1" fill />
                            </div>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                ) : (
                  <div className="columns-2 md:columns-3 lg:columns-4 gap-6 space-y-6 px-2 pb-10">
                    {posts.flatMap(post => post.media.map((m, idx) => ({ ...m, postId: post.id, post, idx }))).map((item, i) => (
                      <div key={`${item.postId}-${item.idx}`}
                        className="break-inside-avoid relative group cursor-pointer animate-fadeInUp"
                        style={{ animationDelay: `${i * 0.05}s`, transform: `rotate(${i % 2 === 0 ? -2 : 2}deg)` }}
                        onClick={() => setSelectedPost({ ...item.post, initialIndex: item.idx })}>
                        <div className="bg-white p-3 pb-8 shadow-md hover:shadow-xl transition-all duration-500 hover:scale-105 hover:rotate-0 hover:z-20 relative transform-gpu">
                          <div className="aspect-square bg-gray-100 overflow-hidden mb-2 shadow-inner">
                            {item.type === 'video' ? <video src={item.url} className="w-full h-full object-cover" muted /> : <img src={item.url} className="w-full h-full object-cover filter contrast-[1.05]" alt="" />}
                          </div>
                          <p className="text-center font-bold text-gray-500 text-xs truncate px-1 absolute bottom-2 left-0 right-0 font-sans opacity-70">
                            {item.post.content || item.post.location || new Date(item.post.date).toLocaleDateString()}
                          </p>
                          <div className="absolute -top-3 left-1/2 -translate-x-1/2 w-16 h-6 bg-white/40 backdrop-blur-[1px] shadow-sm opacity-80" style={{ transform: `translateX(-50%) rotate(${i % 3 === 0 ? -5 : 5}deg)` }}></div>
                          {item.type === 'video' && (
                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-black/20 rounded-full flex items-center justify-center">
                              <Icon name="play" size={12} className="text-white ml-0.5" fill />
                            </div>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                )
              )}

              {/* Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ */}
              {activeTab === 'checklist' && (
                <div className="space-y-6 animate-scaleIn">

                  {/* Í∑∏Î£π ÌÉ≠ Î¶¨Ïä§Ìä∏ */}
                  <div className="card-bg rounded-2xl p-4 border border-theme-100 overflow-hidden">
                    <div className="flex items-center justify-between mb-3">
                      <div className="flex items-center gap-2">
                        <Icon name="folder-heart" size={18} className="text-theme-500" />
                        <span className="font-bold text-primary">Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Í∑∏Î£π</span>
                      </div>
                      {checklistGroups.length > 0 && (
                        <button
                          onClick={() => setChecklistEditMode(prev => !prev)}
                          className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${checklistEditMode
                            ? 'bg-theme-500 text-white'
                            : 'bg-theme-100 text-theme-600 hover:bg-theme-200'
                            }`}
                        >
                          <span className="flex items-center gap-1.5">
                            <Icon name={checklistEditMode ? 'check' : 'settings'} size={14} />
                            {checklistEditMode ? 'ÏôÑÎ£å' : 'Ìé∏Ïßë'}
                          </span>
                        </button>
                      )}
                    </div>

                    <div className="flex items-center gap-2 overflow-x-auto pb-2 scrollbar-hide">
                      {checklistGroups.map(group => (
                        <div key={group.id} className="relative group shrink-0 pt-2 pr-2">
                          {editingGroupId === group.id ? (
                            <div className="flex items-center gap-1 bg-theme-100 rounded-xl px-2 py-2">
                              <input
                                type="text"
                                value={editingGroupName}
                                onChange={(e) => setEditingGroupName(e.target.value)}
                                className="w-24 text-sm bg-transparent border-none focus:ring-0 p-0 font-medium text-theme-700"
                                autoFocus
                                onKeyDown={(e) => {
                                  if (e.key === 'Enter') {
                                    if (editingGroupName.trim()) {
                                      setChecklistGroups(prev => prev.map(g => g.id === group.id ? { ...g, name: editingGroupName.trim() } : g));
                                      setEditingGroupId(null);
                                    }
                                  }
                                }}
                                onBlur={() => {
                                  if (editingGroupName.trim()) {
                                    setChecklistGroups(prev => prev.map(g => g.id === group.id ? { ...g, name: editingGroupName.trim() } : g));
                                  }
                                  setEditingGroupId(null);
                                }}
                              />
                            </div>
                          ) : (
                            <button
                              onClick={() => setSelectedGroupId(group.id)}
                              className={`px-4 py-2 rounded-xl font-medium text-sm btn-bounce transition-all ${selectedGroupId === group.id
                                ? 'gradient-theme text-white shadow-theme'
                                : 'bg-theme-50 text-secondary hover:bg-theme-100'
                                }`}
                            >
                              {group.name}
                              <span className="ml-2 text-xs opacity-70">
                                {checklist.filter(c => c.groupId === group.id).length}
                              </span>
                            </button>
                          )}

                          {/* Ìé∏Ïßë Î™®Îìú: ÏÇ≠Ï†ú Î±ÉÏßÄ */}
                          {checklistEditMode && (
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                setGroupToDelete(group);
                              }}
                              className="absolute top-0 right-0 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center shadow-md hover:bg-red-600 transition-all animate-scaleIn z-10"
                            >
                              <Icon name="minus" size={12} />
                            </button>
                          )}

                          {/* ÏùºÎ∞ò Î™®Îìú: ÏÑ†ÌÉùÎêú Í∑∏Î£π Í¥ÄÎ¶¨ Î©îÎâ¥ Ï†úÍ±∞Îê® */}
                        </div>
                      ))}

                      {/* ÏÉà Í∑∏Î£π Ï∂îÍ∞Ä */}
                      <div className="flex items-center gap-2 shrink-0">
                        <input
                          type="text"
                          placeholder="ÏÉà Í∑∏Î£π"
                          value={newGroupName}
                          onChange={(e) => setNewGroupName(e.target.value)}
                          onKeyDown={(e) => {
                            if (e.key === 'Enter' && newGroupName.trim()) {
                              const newId = Date.now().toString();
                              setChecklistGroups(prev => [...prev, { id: newId, name: newGroupName.trim() }]);
                              setNewGroupName('');
                              setSelectedGroupId(newId);
                            }
                          }}
                          className="w-24 px-3 py-2 bg-theme-50 border-2 border-dashed border-theme-200 rounded-xl text-sm focus:border-theme-300 focus:bg-white transition-all outline-none"
                        />
                        <button
                          onClick={() => {
                            if (newGroupName.trim()) {
                              const newId = Date.now().toString();
                              setChecklistGroups(prev => [...prev, { id: newId, name: newGroupName.trim() }]);
                              setNewGroupName('');
                              setSelectedGroupId(newId);
                            }
                          }}
                          className="p-2 bg-theme-500 text-white rounded-xl hover:bg-theme-600 transition-colors shadow-sm"
                        >
                          <Icon name="plus" size={16} />
                        </button>
                      </div>
                    </div>
                  </div>

                  {/* ÏÉà Ìï≠Î™© Ï∂îÍ∞Ä */}
                  {checklistGroups.length > 0 ? (
                    <div className="card-bg rounded-2xl p-4 border border-theme-100 flex gap-3">
                      <input
                        type="text"
                        placeholder={`${checklistGroups.find(g => g.id === selectedGroupId)?.name || 'Í∑∏Î£π'}Ïóê Ìï≠Î™© Ï∂îÍ∞Ä...`}
                        value={newCheckItem}
                        onChange={(e) => setNewCheckItem(e.target.value)}
                        onKeyDown={(e) => {
                          if (e.key === 'Enter' && newCheckItem.trim()) {
                            setChecklist(prev => [...prev, { id: Date.now().toString(), text: newCheckItem.trim(), checked: false, groupId: selectedGroupId }]);
                            setNewCheckItem('');
                          }
                        }}
                        className="flex-1 bg-theme-50 border-none rounded-xl px-4 py-3 text-primary focus:ring-2 focus:ring-theme-300 placeholder:text-secondary"
                      />
                      <button
                        onClick={() => {
                          if (newCheckItem.trim()) {
                            setChecklist(prev => [...prev, { id: Date.now().toString(), text: newCheckItem.trim(), checked: false, groupId: selectedGroupId }]);
                            setNewCheckItem('');
                          }
                        }}
                        className="gradient-theme text-white px-5 py-3 rounded-xl font-bold btn-bounce flex items-center gap-2"
                      >
                        <Icon name="plus" size={18} />
                      </button>
                    </div>
                  ) : (
                    <div className="card-bg rounded-2xl p-8 text-center border border-theme-100">
                      <p className="text-secondary">Í∑∏Î£πÏùÑ Î®ºÏ†Ä Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî</p>
                    </div>
                  )}

                  {/* Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Î™©Î°ù */}
                  <div className="space-y-3">
                    {checklist.filter(item => item.groupId === selectedGroupId).length === 0 ? (
                      <div className="card-bg rounded-2xl p-8 text-center border border-theme-100">
                        <span className="text-4xl mb-3 block">üìù</span>
                        <p className="text-secondary font-medium">Ïù¥ Í∑∏Î£πÏóê Ìï≠Î™©Ïù¥ ÏóÜÏñ¥Ïöî</p>
                        <p className="text-secondary text-sm mt-1">ÏÉàÎ°úÏö¥ Î™©ÌëúÎ•º Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!</p>
                      </div>
                    ) : (
                      checklist.filter(item => item.groupId === selectedGroupId).map(item => (
                        <ChecklistItem
                          key={item.id}
                          item={item}
                          onToggle={() => setChecklist(prev => prev.map(c => c.id === item.id ? { ...c, checked: !c.checked } : c))}
                          onEdit={(newText) => setChecklist(prev => prev.map(c => c.id === item.id ? { ...c, text: newText } : c))}
                          onDelete={() => setChecklist(prev => prev.filter(c => c.id !== item.id))}
                        />
                      ))
                    )}
                  </div>

                  {/* ÏôÑÎ£å ÌÜµÍ≥Ñ */}
                  {checklist.filter(item => item.groupId === selectedGroupId).length > 0 && (
                    <div className="card-bg rounded-2xl p-4 border border-theme-100">
                      <div className="flex items-center justify-between mb-2">

                        <span className="text-sm font-bold text-secondary">Í∑∏Î£π Îã¨ÏÑ±Î•†</span>
                        <span className="text-lg font-black text-theme-600">
                          {Math.round((checklist.filter(item => item.groupId === selectedGroupId && item.checked).length / checklist.filter(item => item.groupId === selectedGroupId).length) * 100)}%
                        </span>
                      </div>
                      <div className="h-3 bg-theme-100 rounded-full overflow-hidden">
                        <div
                          className="h-full gradient-theme rounded-full transition-all duration-500"
                          style={{ width: `${(checklist.filter(item => item.groupId === selectedGroupId && item.checked).length / checklist.filter(item => item.groupId === selectedGroupId).length) * 100}%` }}
                        />
                      </div>
                    </div>
                  )}
                </div>
              )}

              {/* Î≤ÑÌÇ∑Î¶¨Ïä§Ìä∏ */}
              {activeTab === 'bucket' && (
                <div className="space-y-6 animate-scaleIn">
                  {/* Ìó§Îçî */}
                  <div className="text-center mb-6">
                    <span className="text-4xl mb-2 block">üåü</span>
                    <h2 className="font-black text-2xl text-primary">Ïö∞Î¶¨Ïùò Î≤ÑÌÇ∑Î¶¨Ïä§Ìä∏</h2>
                    <p className="text-secondary text-sm mt-1">Ìï®Íªò Ïù¥Î£®Í≥† Ïã∂ÏùÄ ÍøàÎì§</p>
                  </div>

                  {/* ÏÉà Ìï≠Î™© Ï∂îÍ∞Ä */}
                  <div className="card-bg rounded-2xl p-4 border border-theme-100 flex gap-3">
                    <input
                      type="text"
                      placeholder="Ïù¥Î£®Í≥† Ïã∂ÏùÄ ÍøàÏùÑ Ï†ÅÏñ¥Î≥¥ÏÑ∏Ïöî..."
                      value={newBucketItem}
                      onChange={(e) => setNewBucketItem(e.target.value)}
                      onKeyDown={(e) => {
                        if (e.key === 'Enter' && newBucketItem.trim()) {
                          setBucketList(prev => [...prev, { id: Date.now().toString(), text: newBucketItem.trim(), checked: false, emoji: '‚≠ê' }]);
                          setNewBucketItem('');
                        }
                      }}
                      className="flex-1 bg-theme-50 border-none rounded-xl px-4 py-3 text-primary focus:ring-2 focus:ring-theme-300 placeholder:text-secondary"
                    />
                    <button
                      onClick={() => {
                        if (newBucketItem.trim()) {
                          setBucketList(prev => [...prev, { id: Date.now().toString(), text: newBucketItem.trim(), checked: false, emoji: '‚≠ê' }]);
                          setNewBucketItem('');
                        }
                      }}
                      className="gradient-theme text-white px-5 py-3 rounded-xl font-bold btn-bounce flex items-center gap-2"
                    >
                      <Icon name="plus" size={18} />
                    </button>
                  </div>

                  {/* Î≤ÑÌÇ∑Î¶¨Ïä§Ìä∏ Î™©Î°ù */}
                  <div className="space-y-3">
                    {bucketList.length === 0 ? (
                      <div className="card-bg rounded-2xl p-8 text-center border border-theme-100">
                        <span className="text-4xl mb-3 block">üí´</span>
                        <p className="text-secondary font-medium">Î≤ÑÌÇ∑Î¶¨Ïä§Ìä∏Í∞Ä ÎπÑÏñ¥ÏûàÏñ¥Ïöî</p>
                        <p className="text-secondary text-sm mt-1">Ìï®Íªò Ïù¥Î£®Í≥† Ïã∂ÏùÄ ÍøàÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!</p>
                      </div>
                    ) : (
                      bucketList.map(item => (
                        <BucketItem
                          key={item.id}
                          item={item}
                          onToggle={() => setBucketList(prev => prev.map(b => b.id === item.id ? { ...b, checked: !b.checked } : b))}
                          onEdit={(newText) => setBucketList(prev => prev.map(b => b.id === item.id ? { ...b, text: newText } : b))}
                          onDelete={() => setBucketList(prev => prev.filter(b => b.id !== item.id))}
                          onEmojiChange={(emoji) => setBucketList(prev => prev.map(b => b.id === item.id ? { ...b, emoji } : b))}
                        />
                      ))
                    )}
                  </div>

                  {/* Îã¨ÏÑ± ÌÜµÍ≥Ñ */}
                  {bucketList.length > 0 && (
                    <div className="card-bg rounded-2xl p-4 border border-theme-100">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm font-bold text-secondary">Íøà Îã¨ÏÑ±Î•†</span>
                        <span className="text-lg font-black text-theme-600">
                          {bucketList.filter(b => b.checked).length} / {bucketList.length}
                        </span>
                      </div>
                      <div className="h-3 bg-theme-100 rounded-full overflow-hidden">
                        <div
                          className="h-full gradient-theme rounded-full transition-all duration-500"
                          style={{ width: `${(bucketList.filter(b => b.checked).length / bucketList.length) * 100}%` }}
                        />
                      </div>
                    </div>
                  )}
                </div>
              )}

              {/* Ï∫òÎ¶∞Îçî */}
              {activeTab === 'calendar' && (
                <div className="space-y-6 animate-scaleIn">
                  {/* Îã¨Î†• ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */}
                  <CalendarView
                    posts={posts}
                    settings={settings}
                    dDay={dDay}
                    onSelectPost={setSelectedPost}
                    getMoodInfo={getMoodInfo}
                    calendarNotes={calendarNotes}
                    setCalendarNotes={setCalendarNotes}
                  />
                </div>
              )}
            </div>
          </main >

          {/* Í∑∏Î£π ÏÇ≠Ï†ú ÌôïÏù∏ Î™®Îã¨ */}
          {
            groupToDelete && (
              <Modal onClose={() => setGroupToDelete(null)} small>
                <div className="text-center p-2">
                  <div className="w-14 h-14 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500 animate-pulse-glow">
                    <Icon name="trash-2" size={28} />
                  </div>
                  <h3 className="text-xl font-bold text-primary mb-2">Í∑∏Î£π ÏÇ≠Ï†ú</h3>
                  <p className="text-secondary mb-6 leading-relaxed">
                    <span className="font-bold text-red-500">'{groupToDelete.name}'</span> Í∑∏Î£πÍ≥º<br />
                    Ìè¨Ìï®Îêú Î™®Îì† Ìï≠Î™©Ïù¥ ÏÇ≠Ï†úÎê©ÎãàÎã§.<br />
                    Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?
                  </p>
                  <div className="flex gap-3">
                    <button
                      onClick={() => setGroupToDelete(null)}
                      className="flex-1 py-3 rounded-xl bg-theme-50 text-secondary font-bold hover:bg-theme-100 transition-all"
                    >
                      Ï∑®ÏÜå
                    </button>
                    <button
                      onClick={() => {
                        const group = groupToDelete;
                        setChecklistGroups(prev => {
                          const newGroups = prev.filter(g => g.id !== group.id);
                          if (newGroups.length > 0) {
                            if (selectedGroupId === group.id) setSelectedGroupId(newGroups[0].id);
                          } else {
                            setSelectedGroupId(null);
                          }
                          return newGroups;
                        });
                        setChecklist(prev => prev.filter(c => c.groupId !== group.id));
                        setGroupToDelete(null);
                      }}
                      className="flex-1 py-3 rounded-xl bg-red-500 text-white font-bold hover:bg-red-600 shadow-md transition-all btn-bounce"
                    >
                      ÏÇ≠Ï†úÌïòÍ∏∞
                    </button>
                  </div>
                </div>
              </Modal>
            )
          }

          {/* Î™®Î∞îÏùº ÌïòÎã® ÎÑ§ÎπÑ */}
          <nav className="lg:hidden fixed bottom-0 left-0 right-0 glass border-t border-theme-100 z-40 pb-safe">
            <div className="flex justify-between items-center px-6 h-16">
              <button onClick={() => setActiveTab('feed')} className={`flex flex-col items-center gap-1 p-2 active:scale-90 transition-transform ${activeTab === 'feed' ? 'text-theme-500' : 'text-secondary'}`}>
                <Icon name="layout-grid" size={24} />
              </button>
              <button onClick={handleModalOpen} className="gradient-theme text-white w-14 h-14 rounded-full flex items-center justify-center shadow-theme -mt-8 border-4 border-white active:scale-95 transition-transform">
                <Icon name="plus" size={26} />
              </button>
              <button onClick={() => setActiveTab('gallery')} className={`flex flex-col items-center gap-1 p-2 active:scale-90 transition-transform ${activeTab === 'gallery' ? 'text-theme-500' : 'text-secondary'}`}>
                <Icon name="image" size={24} />
              </button>
            </div>
          </nav>

          {/* Îç∞Ïä§ÌÅ¨ÌÉë FAB */}
          <button onClick={handleModalOpen} className="fixed bottom-6 right-6 lg:bottom-10 lg:right-10 px-6 py-4 gradient-theme shadow-theme hover:shadow-lg transition-all hover:scale-105 active:scale-95 flex items-center gap-2 z-40 btn-bounce btn-primary-text rounded-full">
            <Icon name="plus" size={24} strokeWidth={2.5} />
            <span className="font-bold text-lg">Í∏∞Î°ù Ï∂îÍ∞ÄÌïòÍ∏∞</span>
          </button>

          {/* Í∏∞Î°ù Ï∂îÍ∞Ä Î™®Îã¨ */}
          {
            isModalOpen && (
              <Modal onClose={() => { setIsModalOpen(false); resetForm(); }}>
                <ModalHeader title="‚ú® Ïò§ÎäòÏùò Í∏∞Ïñµ" subtitle="ÏÜåÏ§ëÌïú ÏàúÍ∞ÑÏùÑ Í∏∞Î°ùÏúºÎ°ú" onClose={() => { setIsModalOpen(false); resetForm(); }} />
                <PostForm post={newPost} setPost={setNewPost} onSubmit={handleAddPost} submitLabel="üíï Ï†ÄÏû•ÌïòÍ∏∞" />
              </Modal>
            )
          }

          {/* ÏàòÏ†ï Î™®Îã¨ */}
          {
            editingPost && (
              <Modal onClose={() => setEditingPost(null)}>
                <ModalHeader title="‚úèÔ∏è Í∏∞Î°ù ÏàòÏ†ï" subtitle="Ï∂îÏñµÏùÑ Îã§Ïãú Ìé∏ÏßëÌï¥Ïöî" onClose={() => setEditingPost(null)} />
                <PostForm post={editingPost} setPost={setEditingPost} onSubmit={handleEditPost} submitLabel="‚úÖ ÏàòÏ†ï ÏôÑÎ£å" />
              </Modal>
            )
          }

          {/* ÏÇ≠Ï†ú ÌôïÏù∏ */}
          {
            deleteConfirm && (
              <Modal onClose={() => setDeleteConfirm(null)} small>
                <div className="text-center py-4">
                  <div className="w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center">
                    <Icon name="trash-2" size={28} className="text-red-500" />
                  </div>
                  <h3 className="text-xl font-bold text-primary mb-2">Ï†ïÎßê ÏÇ≠Ï†úÌï†ÍπåÏöî?</h3>
                  <p className="text-secondary text-sm mb-6">Ïù¥ Í∏∞Î°ùÏùÄ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏñ¥Ïöî.</p>
                  <div className="flex gap-3">
                    <button onClick={() => setDeleteConfirm(null)} className="flex-1 py-3 rounded-xl border-2 border-theme-200 text-secondary font-bold btn-bounce">Ï∑®ÏÜå</button>
                    <button onClick={() => handleDeletePost(deleteConfirm)} className="flex-1 py-3 rounded-xl bg-red-500 text-white font-bold btn-bounce">ÏÇ≠Ï†ú</button>
                  </div>
                </div>
              </Modal>
            )
          }

          {/* ÏÉÅÏÑ∏ Î≥¥Í∏∞ */}
          {
            selectedPost && (
              <DetailView
                post={selectedPost}
                settings={settings}
                getMoodInfo={getMoodInfo}
                onClose={() => setSelectedPost(null)}
                isEditMode={isEditMode}
                onEdit={() => { setEditingPost({ ...selectedPost }); setSelectedPost(null); }}
                onDelete={() => { setDeleteConfirm(selectedPost.id); setSelectedPost(null); }}
              />
            )
          }

          {/* ÏÑ§Ï†ï */}
          {
            isSettingsOpen && (
              <Modal onClose={() => setIsSettingsOpen(false)}>
                <ModalHeader title="‚öôÔ∏è ÏÑ§Ï†ï" subtitle="Ïö∞Î¶¨Ïùò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî" onClose={() => setIsSettingsOpen(false)} />
                <form onSubmit={(e) => { e.preventDefault(); setIsSettingsOpen(false); }} className="space-y-5">
                  <InputField label="Ïö∞Î¶¨ Ïù¥Î¶Ñ" value={settings.coupleName} onChange={v => setSettings({ ...settings, coupleName: v })} placeholder="Ïòà: Ïö∞ÏßÑ & Ïú†ÎÇò" />
                  <div className="grid grid-cols-2 gap-4">
                    <InputField label="Î©îÏù∏ ÌÉÄÏù¥ÌãÄ" value={settings.appTitle || ''} onChange={v => setSettings({ ...settings, appTitle: v })} placeholder="Our Story" />
                    <InputField label="ÏÑúÎ∏å ÌÉÄÏù¥ÌãÄ" value={settings.appSubtitle || ''} onChange={v => setSettings({ ...settings, appSubtitle: v })} placeholder="Ïö∞Î¶¨Ïùò Ïù¥ÏïºÍ∏∞" />
                  </div>
                  <div className="hidden">
                    <InputField label="ÎÇòÏùò Ïù¥Î¶Ñ" value={settings.myName} onChange={v => setSettings({ ...settings, myName: v })} />
                    <InputField label="ÏÉÅÎåÄÎ∞© Ïù¥Î¶Ñ" value={settings.partnerName} onChange={v => setSettings({ ...settings, partnerName: v })} />
                  </div>
                  <InputField label="ÏãúÏûëÌïú ÎÇ†" type="date" value={settings.anniversaryDate} onChange={v => setSettings({ ...settings, anniversaryDate: v })} icon="heart" />
                  <button type="submit" className="w-full py-4 rounded-2xl gradient-theme text-white font-bold shadow-theme btn-bounce">Ï†ÄÏû•ÌïòÍ∏∞</button>
                </form>
              </Modal>
            )
          }

          {/* ÌÖåÎßà ÏÑ†ÌÉù */}
          {
            isThemePickerOpen && (
              <Modal onClose={() => setIsThemePickerOpen(false)} small>
                <ModalHeader title="üé® ÌÖåÎßà ÏÑ†ÌÉù" subtitle="ÏÉâÏÉÅÏùÑ Í≥®ÎùºÎ≥¥ÏÑ∏Ïöî" onClose={() => setIsThemePickerOpen(false)} />
                <div className="grid grid-cols-2 gap-3">
                  {THEMES.map(theme => (
                    <button key={theme.id} onClick={() => { setSettings({ ...settings, theme: theme.id }); setIsThemePickerOpen(false); }}
                      className={`p-4 rounded-2xl border-2 transition-all btn-bounce flex items-center gap-3 ${settings.theme === theme.id ? 'border-current shadow-lg scale-105' : 'border-transparent bg-theme-50'
                        }`} style={{ borderColor: settings.theme === theme.id ? theme.color : undefined }}>
                      <span className="text-2xl">{theme.emoji}</span>
                      <span className="font-medium text-sm text-primary">{theme.name}</span>
                    </button>
                  ))}
                </div>
              </Modal>
            )}
          {/* Í¥ÄÎ¶¨Ïûê Î™®Îã¨ (ÏûëÍ≥† Ïã¨ÌîåÌïòÍ≤å) */}
          {isAdminOpen && (
            <Modal onClose={() => setIsAdminOpen(false)} small>
              <ModalHeader title="üõ†Ô∏è Í¥ÄÎ¶¨Ïûê ÏÑ§Ï†ï" subtitle="Ïï±Ïùò Î¨∏Íµ¨Î•º ÎÇ¥ ÎßàÏùåÎåÄÎ°ú!" onClose={() => setIsAdminOpen(false)} />
              <div className="space-y-6 max-h-[60vh] overflow-y-auto pr-2 scrollbar-hide">
                <div>
                  <h4 className="font-bold text-sm mb-3 text-secondary">ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÌÉ≠ Ïù¥Î¶Ñ</h4>
                  <div className="space-y-3">
                    {['feed', 'gallery', 'checklist', 'bucket', 'calendar'].map(key => (
                      <InputField key={`tab-${key}`} label={key.toUpperCase()} value={settings.customTabs ? settings.customTabs[key] : ''}
                        onChange={v => setSettings({ ...settings, customTabs: { ...settings.customTabs, [key]: v } })} />
                    ))}
                  </div>
                </div>
                <div className="border-t border-theme-100 pt-6">
                  <h4 className="font-bold text-sm mb-3 text-secondary">ÌéòÏù¥ÏßÄ Î©îÏù∏ Ï†úÎ™©</h4>
                  <div className="space-y-3">
                    {['feed', 'gallery', 'calendar'].map(key => (
                      <div key={`header-${key}`} className="flex gap-2">
                        <div className="w-16">
                          <InputField label="Ïù¥Î™®ÏßÄ" value={settings.customIcons ? settings.customIcons[key] : ''}
                            onChange={v => setSettings({ ...settings, customIcons: { ...settings.customIcons, [key]: v } })} />
                        </div>
                        <div className="flex-1">
                          <InputField label={key === 'feed' ? 'Timeline Ï†úÎ™©' : key === 'gallery' ? 'Gallery Ï†úÎ™©' : 'Anniversary Ï†úÎ™©'}
                            value={settings.customHeaders ? settings.customHeaders[key] : ''}
                            onChange={v => setSettings({ ...settings, customHeaders: { ...settings.customHeaders, [key]: v } })} />
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </Modal>
          )}
        </div >
      );
    };



    // ÏÉÅÏÑ∏ Î≥¥Í∏∞ Ïª¥Ìè¨ÎÑåÌä∏ (Ï†ÑÏ≤¥ Î¶¨ÎîîÏûêÏù∏)
    const DetailView = ({ post, settings, getMoodInfo, onClose, isEditMode, onEdit, onDelete }) => {
      const [currentIndex, setCurrentIndex] = useState(post.initialIndex || 0);
      const moodInfo = getMoodInfo(post.mood);
      const media = post.media || [];
      const [zoomImage, setZoomImage] = useState(null);

      const goNext = () => setCurrentIndex(prev => (prev + 1) % media.length);
      const goPrev = () => setCurrentIndex(prev => (prev - 1 + media.length) % media.length);

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-4">
          {/* Î∞∞Í≤Ω */}
          <div className="absolute inset-0 bg-black/70 backdrop-blur-lg animate-fadeIn" onClick={onClose} />

          {/* Ïª®ÌÖåÏù¥ÎÑà */}
          <div className="relative detail-modal w-full max-w-5xl card-bg rounded-[2rem] shadow-2xl overflow-hidden animate-scaleIn">
            {/* Îã´Í∏∞ Î≤ÑÌäº */}
            <button onClick={onClose} className="absolute top-4 right-4 z-20 w-10 h-10 bg-black/40 hover:bg-black/60 backdrop-blur rounded-full flex items-center justify-center text-white transition-all btn-bounce">
              <Icon name="x" size={20} />
            </button>

            {/* Ïä§ÌÅ¨Î°§ Í∞ÄÎä•Ìïú ÎÇ¥Ïö© */}
            <div className="detail-scroll">
              {/* ÎØ∏ÎîîÏñ¥ ÏÑπÏÖò */}
              <div className={`relative bg-black aspect-[16/10] sm:aspect-[16/9] ${(post.filter && post.filter !== 'none') ? `filter-${post.filter}` : ''}`}>
                {media.length > 0 && (
                  <>
                    {media[currentIndex].type === 'video' ? (
                      <video src={media[currentIndex].url} className="w-full h-full object-contain" controls autoPlay />
                    ) : (
                      <img
                        src={media[currentIndex].url}
                        className="w-full h-full object-contain cursor-zoom-in hover:opacity-90 transition-opacity"
                        alt=""
                        onClick={() => setZoomImage(media[currentIndex].url)}
                        title="ÌÅ¥Î¶≠ÌïòÏó¨ ÌôïÎåÄ"
                      />
                    )}

                    {/* ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î≤ÑÌäº */}
                    {media.length > 1 && (
                      <>
                        <button onClick={goPrev} className="absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/20 hover:bg-white/40 backdrop-blur-md rounded-full flex items-center justify-center text-white transition-all btn-bounce">
                          <Icon name="chevron-left" size={24} />
                        </button>
                        <button onClick={goNext} className="absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/20 hover:bg-white/40 backdrop-blur-md rounded-full flex items-center justify-center text-white transition-all btn-bounce">
                          <Icon name="chevron-right" size={24} />
                        </button>

                        {/* Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ */}
                        <div className="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2">
                          {media.map((_, i) => (
                            <button key={i} onClick={() => setCurrentIndex(i)}
                              className={`h-2 rounded-full transition-all ${i === currentIndex ? 'w-8 bg-white' : 'w-2 bg-white/50 hover:bg-white/70'}`} />
                          ))}
                        </div>

                        {/* Ïπ¥Ïö¥ÌÑ∞ */}
                        <div className="absolute top-4 left-4 bg-black/40 backdrop-blur px-3 py-1.5 rounded-full text-white text-sm font-medium">
                          {currentIndex + 1} / {media.length}
                        </div>
                      </>
                    )}
                  </>
                )}
              </div>

              {/* Ï†ïÎ≥¥ ÏÑπÏÖò */}
              <div className="p-6 sm:p-8 space-y-6">
                {/* Î©îÌÉÄ Ï†ïÎ≥¥ */}
                <div className="flex items-center gap-4 flex-wrap">
                  <div className="flex items-center gap-2 bg-theme-100 px-4 py-2 rounded-full">
                    <span className="text-xl">{moodInfo.emoji}</span>
                    <span className="font-bold text-theme-600">{moodInfo.label}</span>
                  </div>
                  <div className="flex items-center gap-2 text-secondary">
                    <Icon name="calendar" size={16} />
                    <span className="text-sm font-medium">
                      {new Date(post.date).toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' })}
                    </span>
                  </div>
                  <div className="flex items-center gap-2 text-secondary">
                    <Icon name="map-pin" size={16} />
                    <span className="text-sm font-medium">{post.location}</span>
                  </div>
                </div>

                {/* ÏûëÏÑ±Ïûê */}
                <div className="flex items-center gap-3 pb-4 border-b border-theme-100">
                  <div className="w-10 h-10 gradient-theme rounded-full flex items-center justify-center text-white font-bold">
                    {(post.author === 'me' ? settings.myName : settings.partnerName).charAt(0)}
                  </div>
                  <div>
                    <p className="font-bold text-primary">{post.author === 'me' ? settings.myName : settings.partnerName}Ïùò Í∏∞Î°ù</p>
                    <p className="text-xs text-secondary">{settings.coupleName}</p>
                  </div>
                </div>

                {/* Î≥∏Î¨∏ */}
                <p className="text-lg sm:text-xl leading-relaxed text-primary whitespace-pre-wrap">{post.content}</p>

                {/* Ïç∏ÎÑ§Ïùº Î™©Î°ù */}
                {media.length > 1 && (
                  <div className="pt-4 border-t border-theme-100">
                    <p className="text-sm font-bold text-secondary mb-3">Î™®Îì† ÏÇ¨ÏßÑ/ÎèôÏòÅÏÉÅ</p>
                    <div className="flex gap-2 overflow-x-auto pb-2">
                      {media.map((m, idx) => (
                        <button key={idx} onClick={() => setCurrentIndex(idx)}
                          className={`relative flex-shrink-0 w-20 h-20 rounded-xl overflow-hidden transition-all ${idx === currentIndex ? 'ring-3 ring-theme-500 scale-105' : 'opacity-70 hover:opacity-100'
                            }`}>
                          {m.type === 'video' ? (
                            <video src={m.url} className="w-full h-full object-cover" muted />
                          ) : (
                            <img src={m.url} className="w-full h-full object-cover" alt="" />
                          )}
                          {m.type === 'video' && (
                            <div className="absolute inset-0 flex items-center justify-center bg-black/30">
                              <Icon name="play" size={16} className="text-white" />
                            </div>
                          )}
                        </button>
                      ))}
                    </div>
                  </div>
                )}

                {/* Ìé∏Ïßë Î™®ÎìúÏùº Îïå ÏàòÏ†ï/ÏÇ≠Ï†ú Î≤ÑÌäº */}
                {isEditMode && (
                  <div className="flex gap-3 pt-4 border-t border-theme-100">
                    <button
                      onClick={onEdit}
                      className="flex-1 py-4 rounded-2xl bg-theme-100 text-theme-600 font-bold btn-bounce flex items-center justify-center gap-2 text-lg"
                    >
                      <Icon name="pencil" size={20} /> ÏàòÏ†ïÌïòÍ∏∞
                    </button>
                    <button
                      onClick={onDelete}
                      className="flex-1 py-4 rounded-2xl bg-red-100 text-red-600 font-bold btn-bounce flex items-center justify-center gap-2 text-lg"
                    >
                      <Icon name="trash-2" size={20} /> ÏÇ≠Ï†úÌïòÍ∏∞
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>

          {/* Ïù¥ÎØ∏ÏßÄ ÌôïÎåÄ Î∑∞ */}
          {zoomImage && <ImageZoom src={zoomImage} onClose={() => setZoomImage(null)} />}
        </div>
      );
    };

    // ÏÑúÎ∏å Ïª¥Ìè¨ÎÑåÌä∏Îì§
    const Modal = ({ children, onClose, small = false }) => (
      <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center sm:p-4">
        <div className="absolute inset-0 bg-black/40 backdrop-blur-md animate-fadeIn" onClick={onClose} />
        <div className={`relative w-full ${small ? 'max-w-sm' : 'max-w-lg'} card-bg rounded-t-[2rem] rounded-b-none sm:rounded-[2rem] shadow-2xl p-6 overflow-y-auto max-h-[85vh] sm:max-h-[90vh] animate-slideUp sm:animate-scaleIn pb-safe`}>
          {/* Mobile Handle Bar */}
          <div className="w-12 h-1.5 bg-gray-300/50 rounded-full mx-auto mb-6 sm:hidden" />
          {children}
        </div>
      </div>
    );

    const ModalHeader = ({ title, subtitle, onClose }) => (
      <div className="flex justify-between items-start mb-6">
        <div>
          <h3 className="text-2xl font-bold text-primary">{title}</h3>
          <p className="text-secondary text-sm mt-1">{subtitle}</p>
        </div>
        <button onClick={onClose} className="p-2 hover:bg-theme-50 rounded-full text-secondary btn-bounce">
          <Icon name="x" size={24} />
        </button>
      </div>
    );

    const InputField = ({ label, value, onChange, placeholder, type = 'text', icon }) => (
      <div>
        <label className="block text-sm font-bold text-primary mb-2">{label}</label>
        <div className="relative">
          {icon && <Icon name={icon} size={18} className="absolute left-4 top-1/2 -translate-y-1/2 text-theme-400" />}
          <input type={type} value={value} onChange={e => onChange(e.target.value)} placeholder={placeholder}
            className={`w-full bg-theme-50 border-2 border-transparent rounded-xl ${icon ? 'pl-12' : 'px-4'} pr-4 py-3 text-primary focus:ring-0 focus:border-theme-300 transition-all placeholder:text-secondary`} />
        </div>
      </div>
    );

    const PostForm = ({ post, setPost, onSubmit, submitLabel }) => {
      const fileInputRef = useRef(null);
      const [isDragging, setIsDragging] = useState(false);

      const handleFileSelect = (files) => {
        Array.from(files).forEach(file => {
          const isVideo = file.type.startsWith('video/');

          if (isVideo) {
            // ÎèôÏòÅÏÉÅÏùÄ ÌÅ¨Í∏∞ Ï†úÌïú (50MB)
            if (file.size > 50 * 1024 * 1024) {
              alert('ÎèôÏòÅÏÉÅÏùÄ 50MB Ïù¥ÌïòÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.');
              return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
              setPost(prev => ({
                ...prev,
                media: [...prev.media, { url: e.target.result, type: 'video', name: file.name }]
              }));
            };
            reader.readAsDataURL(file);
          } else {
            // Ïù¥ÎØ∏ÏßÄÎäî ÏïïÏ∂ï Ï≤òÎ¶¨
            const img = new Image();
            const reader = new FileReader();
            reader.onload = (e) => {
              img.src = e.target.result;
              img.onload = () => {
                const canvas = document.createElement('canvas');
                const maxSize = 1200;
                let { width, height } = img;

                if (width > maxSize || height > maxSize) {
                  if (width > height) {
                    height = (height / width) * maxSize;
                    width = maxSize;
                  } else {
                    width = (width / height) * maxSize;
                    height = maxSize;
                  }
                }

                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);

                const compressedUrl = canvas.toDataURL('image/jpeg', 0.8);
                setPost(prev => ({
                  ...prev,
                  media: [...prev.media, { url: compressedUrl, type: 'image', name: file.name }]
                }));
              };
            };
            reader.readAsDataURL(file);
          }
        });
      };

      const handleDrop = (e) => {
        e.preventDefault();
        setIsDragging(false);
        if (e.dataTransfer.files.length) handleFileSelect(e.dataTransfer.files);
      };

      const removeMedia = (idx) => {
        const newMedia = post.media.filter((_, i) => i !== idx);
        setPost({ ...post, media: newMedia, thumbnailIndex: Math.min(post.thumbnailIndex, Math.max(0, newMedia.length - 1)) });
      };

      return (
        <form onSubmit={onSubmit} className="space-y-5">
          {/* Í∞êÏ†ï */}
          <div>
            <label className="block text-sm font-bold text-primary mb-3">Ïò§ÎäòÏùò Í∞êÏ†ï</label>
            <div className="flex flex-wrap gap-2">
              {MOOD_OPTIONS.map(mood => (
                <button key={mood.id} type="button" onClick={() => setPost({ ...post, mood: post.mood === mood.id ? null : mood.id })}
                  className={`flex flex-col items-center justify-center w-16 h-16 rounded-2xl border transition-all ${post.mood === mood.id ? `${mood.bg} ${mood.color} border-current ring-1 ring-current shadow-sm` : 'border-transparent bg-gray-50 text-gray-400 hover:bg-gray-100 hover:text-gray-500'
                    }`}>
                  <Icon name={mood.icon} size={24} className="mb-0.5" />
                  <span className="text-[10px] font-bold">{mood.label}</span>
                </button>
              ))}
            </div>
          </div>

          {/* ÎÇ¥Ïö© */}
          <div>
            <label className="block text-sm font-bold text-primary mb-2">Î¨¥Ïä® ÏùºÏù¥ ÏûàÏóàÎÇòÏöî?</label>
            <textarea rows="3" required placeholder="Ïò§ÎäòÏùò Ï∂îÏñµÏùÑ ÏûêÏú†Î°≠Í≤å..."
              className="w-full bg-theme-50 border-2 border-transparent rounded-2xl p-4 text-primary focus:ring-0 focus:border-theme-300 transition-all resize-none placeholder:text-secondary"
              value={post.content} onChange={e => setPost({ ...post, content: e.target.value })} />
          </div>

          {/* ÎÇ†Ïßú & Ïû•ÏÜå */}
          <div className="grid grid-cols-2 gap-3">
            <InputField label="ÎÇ†Ïßú" type="date" value={post.date} onChange={v => setPost({ ...post, date: v })} icon="calendar-days" />
            <InputField label="Ïû•ÏÜå" value={post.location} onChange={v => setPost({ ...post, location: v })} placeholder="Ïñ¥ÎîîÏÑú?" icon="map-pin" />
          </div>

          {/* ÌååÏùº ÏóÖÎ°úÎìú */}
          <div>
            <label className="block text-sm font-bold text-primary mb-2">ÏÇ¨ÏßÑ/ÎèôÏòÅÏÉÅ</label>
            <div
              className={`file-upload-zone rounded-2xl p-6 text-center cursor-pointer ${isDragging ? 'dragover' : ''}`}
              onClick={() => fileInputRef.current?.click()}
              onDragOver={(e) => { e.preventDefault(); setIsDragging(true); }}
              onDragLeave={() => setIsDragging(false)}
              onDrop={handleDrop}
            >
              <input ref={fileInputRef} type="file" accept="image/*,video/*" multiple className="hidden"
                onChange={(e) => handleFileSelect(e.target.files)} />
              <Icon name="upload-cloud" size={32} className="mx-auto text-theme-400 mb-2" />
              <p className="text-sm text-secondary">ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò ÌååÏùºÏùÑ ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</p>
              <p className="text-xs text-secondary mt-1">Ïù¥ÎØ∏ÏßÄ, ÎèôÏòÅÏÉÅ Î™®Îëê Í∞ÄÎä•</p>
            </div>

            {/* ÎØ∏ÎîîÏñ¥ ÎØ∏Î¶¨Î≥¥Í∏∞ */}
            {post.media.length > 0 && (
              <div className="mt-3">
                <p className="text-xs text-secondary mb-2">ÌÅ¥Î¶≠ÌïòÏó¨ ÎåÄÌëú Ïù¥ÎØ∏ÏßÄ ÏÑ†ÌÉù</p>
                <div className="flex flex-wrap gap-2">
                  {post.media.map((m, idx) => (
                    <div key={idx} onClick={() => setPost({ ...post, thumbnailIndex: idx })}
                      className={`relative w-20 h-20 rounded-xl overflow-hidden cursor-pointer transition-all ${post.thumbnailIndex === idx ? 'ring-3 ring-theme-500 scale-105' : 'opacity-80 hover:opacity-100'
                        }`}>
                      {m.type === 'video' ? (
                        <video src={m.url} className="w-full h-full object-cover" muted />
                      ) : (
                        <img src={m.url} className="w-full h-full object-cover" alt="" />
                      )}
                      <button type="button" onClick={(e) => { e.stopPropagation(); removeMedia(idx); }}
                        className="absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs font-bold">√ó</button>
                      {post.thumbnailIndex === idx && (
                        <div className="absolute bottom-1 left-1 bg-theme-500 text-white text-[8px] px-1.5 py-0.5 rounded-full font-bold">ÎåÄÌëú</div>
                      )}
                      {m.type === 'video' && (
                        <div className="absolute inset-0 flex items-center justify-center bg-black/30">
                          <Icon name="play" size={14} className="text-white" />
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>

          <button type="submit" className="w-full py-4 rounded-2xl gradient-theme font-bold shadow-theme btn-bounce text-lg btn-primary-text">{submitLabel}</button>
        </form>
      );
    };

    const PostCard = ({ post, settings, getMoodInfo, onClick, isEditMode, onEdit, onDelete }) => {
      const moodInfo = getMoodInfo(post.mood);
      const thumbnail = post.media[post.thumbnailIndex] || post.media[0];
      const dateStr = new Date(post.date).toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });

      return (
        <div className={`card-bg rounded-[2rem] shadow-sm border border-theme-100 overflow-hidden ${!isEditMode && 'card-hover cursor-pointer'}`}
          onClick={onClick}>
          <div className="p-5 sm:p-6">
            <div className="flex justify-between items-center mb-4">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-theme-100 flex items-center justify-center text-xl">{moodInfo.emoji}</div>
                <div>
                  <p className="text-sm font-bold text-primary">{post.author === 'me' ? settings.myName : settings.partnerName}</p>
                  <p className="text-xs text-secondary">{dateStr} ¬∑ {post.location}</p>
                </div>
              </div>
              {isEditMode && (
                <div className="flex gap-1">
                  <button onClick={(e) => { e.stopPropagation(); onEdit(); }} className="p-2 text-theme-500 hover:bg-theme-100 rounded-xl transition-all btn-bounce">
                    <Icon name="pencil" size={18} />
                  </button>
                  <button onClick={(e) => { e.stopPropagation(); onDelete(); }} className="p-2 text-red-500 hover:bg-red-100 rounded-xl transition-all btn-bounce">
                    <Icon name="trash-2" size={18} />
                  </button>
                </div>
              )}
            </div>

            <div className="relative rounded-2xl overflow-hidden aspect-[3/2] mb-4 group">
              {thumbnail?.type === 'video' ? (
                <video src={thumbnail.url} className="w-full h-full object-cover" muted />
              ) : (
                <img src={thumbnail?.url} alt="" className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" />
              )}
              {post.media.length > 1 && (
                <div className="absolute top-3 right-3 glass px-3 py-1.5 rounded-full text-xs font-bold text-primary">
                  +{post.media.length - 1}
                </div>
              )}
              {thumbnail?.type === 'video' && (
                <div className="absolute inset-0 flex items-center justify-center">
                  <div className="w-14 h-14 bg-white/30 backdrop-blur rounded-full flex items-center justify-center">
                    <Icon name="play" size={24} className="text-white ml-1" fill />
                  </div>
                </div>
              )}
            </div>

            <p className="text-base font-medium leading-relaxed text-primary line-clamp-2">{post.content}</p>
          </div>
        </div>
      );
    };

    // Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏïÑÏù¥ÌÖú Ïª¥Ìè¨ÎÑåÌä∏
    const ChecklistItem = ({ item, onToggle, onEdit, onDelete }) => {
      const [isEditing, setIsEditing] = useState(false);
      const [editText, setEditText] = useState(item.text);
      const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
      const inputRef = useRef(null);

      useEffect(() => {
        if (isEditing && inputRef.current) {
          inputRef.current.focus();
          inputRef.current.select();
        }
      }, [isEditing]);

      const handleSave = () => {
        if (editText.trim()) {
          onEdit(editText.trim());
        } else {
          setEditText(item.text);
        }
        setIsEditing(false);
      };

      if (showDeleteConfirm) {
        return (
          <div className="card-bg rounded-2xl p-4 border-2 border-red-200 bg-red-50 flex items-center gap-4 animate-scaleIn">
            <div className="flex-1">
              <p className="font-bold text-red-600 text-sm">Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
              <p className="text-red-400 text-xs mt-1">"{item.text}"</p>
            </div>
            <button
              onClick={() => setShowDeleteConfirm(false)}
              className="px-4 py-2 rounded-xl bg-white border border-gray-200 text-secondary font-medium text-sm btn-bounce"
            >
              Ï∑®ÏÜå
            </button>
            <button
              onClick={() => { onDelete(); setShowDeleteConfirm(false); }}
              className="px-4 py-2 rounded-xl bg-red-500 text-white font-medium text-sm btn-bounce"
            >
              ÏÇ≠Ï†ú
            </button>
          </div>
        );
      }

      return (
        <div className={`card-bg rounded-2xl p-4 border border-theme-100 flex items-center gap-4 transition-all ${item.checked ? 'opacity-60' : ''}`}>
          <button
            onClick={onToggle}
            className={`w-8 h-8 rounded-xl flex items-center justify-center btn-bounce transition-all flex-shrink-0 ${item.checked ? 'gradient-theme text-white' : 'bg-theme-50 text-theme-300 border-2 border-theme-200'
              }`}
          >
            {item.checked && <Icon name="check" size={16} />}
          </button>

          {isEditing ? (
            <input
              ref={inputRef}
              type="text"
              value={editText}
              onChange={(e) => setEditText(e.target.value)}
              onBlur={handleSave}
              onKeyDown={(e) => {
                if (e.key === 'Enter') handleSave();
                if (e.key === 'Escape') { setEditText(item.text); setIsEditing(false); }
              }}
              className="flex-1 bg-theme-50 border-2 border-theme-300 rounded-xl px-3 py-2 text-primary focus:ring-0 focus:border-theme-400"
            />
          ) : (
            <span
              className={`flex-1 font-medium cursor-pointer ${item.checked ? 'line-through text-secondary' : 'text-primary'}`}
              onDoubleClick={() => !item.checked && setIsEditing(true)}
            >
              {item.text}
            </span>
          )}

          <button
            onClick={() => setIsEditing(true)}
            className="px-3 py-2 bg-theme-100 text-theme-600 hover:bg-theme-200 rounded-xl flex items-center gap-1.5 transition-all flex-shrink-0 btn-bounce text-sm font-medium"
          >
            <Icon name="pencil" size={14} />
            <span>ÏàòÏ†ï</span>
          </button>
          <button
            onClick={() => setShowDeleteConfirm(true)}
            className="px-3 py-2 bg-red-100 text-red-600 hover:bg-red-200 rounded-xl flex items-center gap-1.5 transition-all flex-shrink-0 btn-bounce text-sm font-medium"
          >
            <Icon name="trash-2" size={14} />
            <span>ÏÇ≠Ï†ú</span>
          </button>
        </div>
      );
    };

    // Î≤ÑÌÇ∑Î¶¨Ïä§Ìä∏ ÏïÑÏù¥ÌÖú Ïª¥Ìè¨ÎÑåÌä∏
    const BucketItem = ({ item, onToggle, onEdit, onDelete, onEmojiChange }) => {
      const [isEditing, setIsEditing] = useState(false);
      const [editText, setEditText] = useState(item.text);
      const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
      const [showEmojiPicker, setShowEmojiPicker] = useState(false);
      const inputRef = useRef(null);

      useEffect(() => {
        if (isEditing && inputRef.current) inputRef.current.focus();
      }, [isEditing]);

      const handleSave = () => {
        if (editText.trim() && editText !== item.text) onEdit(editText.trim());
        setIsEditing(false);
      };

      const emojiOptions = [
        // Ïó¨Ìñâ/Ïû•ÏÜå
        '‚úàÔ∏è', 'üè†', 'üöó', '‚õ∫', 'üèñÔ∏è', 'üè∞', 'üó∫Ô∏è', 'üóΩ',
        // Ï∑®ÎØ∏/ÌôúÎèô
        'üé®', 'üé∏', 'üì∑', 'üç≥', 'üìö', 'üéÆ', 'üé¨', 'üéπ',
        // Ïö¥Îèô/Í±¥Í∞ï
        'üèÉ', 'üí™', 'üßò', 'üö≤', 'üèä', 'üéæ', '‚öΩ', 'üèÄ',
        // Í∏∞ÎÖê/ÏÇ¨Îûë
        '‚ù§Ô∏è', 'üíç', 'üë∂', 'üéÇ', 'üíê', 'üéÅ', 'ü•Ç', 'üíå',
        // ÏÑ±Ï∑®/Íøà
        'üéì', 'üí∞', 'üèÜ', '‚≠ê', 'üåà', 'üöÄ', 'üîÆ', 'üíé'
      ];

      if (showDeleteConfirm) {
        return (
          <div className="card-bg rounded-2xl p-4 border-2 border-red-200 animate-scaleIn">
            <p className="text-center text-primary font-medium mb-3">Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
            <p className="text-center text-sm text-secondary mb-4 line-clamp-1">"{item.text}"</p>
            <div className="flex gap-2">
              <button onClick={() => setShowDeleteConfirm(false)} className="flex-1 py-2 bg-theme-100 text-theme-600 rounded-xl font-medium">Ï∑®ÏÜå</button>
              <button onClick={() => { onDelete(); setShowDeleteConfirm(false); }} className="flex-1 py-2 bg-red-500 text-white rounded-xl font-medium">ÏÇ≠Ï†ú</button>
            </div>
          </div>
        );
      }

      return (
        <div className={`card-bg rounded-2xl p-4 border transition-all ${item.checked ? 'border-green-200 bg-green-50/50' : 'border-theme-100'} flex items-center gap-3 hover:shadow-md z-10 relative`}>
          {/* Ïù¥Î™®ÏßÄ */}
          <div className="relative">
            <button
              onClick={() => setShowEmojiPicker(!showEmojiPicker)}
              className="w-12 h-12 rounded-xl bg-theme-50 flex items-center justify-center text-2xl hover:bg-theme-100 transition-all hover:scale-110"
            >
              {item.emoji || '‚≠ê'}
            </button>
            {showEmojiPicker && (
              <>
                <div className="fixed inset-0 z-[100]" onClick={() => setShowEmojiPicker(false)} />
                <div className="absolute top-full left-0 mt-2 bg-white card-bg rounded-2xl shadow-2xl p-4 grid grid-cols-4 gap-2 z-[101] animate-scaleIn border border-theme-100 w-64 max-h-60 overflow-y-auto custom-scrollbar">
                  {emojiOptions.map(emoji => (
                    <button
                      key={emoji}
                      onClick={() => { onEmojiChange(emoji); setShowEmojiPicker(false); }}
                      className="w-10 h-10 flex items-center justify-center hover:bg-theme-100 rounded-xl transition-all text-2xl btn-bounce"
                    >
                      {emoji}
                    </button>
                  ))}
                </div>
              </>
            )}
          </div>

          {/* Ï≤¥ÌÅ¨ Î≤ÑÌäº */}
          <button
            onClick={onToggle}
            className={`w-7 h-7 rounded-full border-2 flex items-center justify-center transition-all flex-shrink-0 ${item.checked
              ? 'bg-green-500 border-green-500 text-white'
              : 'border-theme-300 hover:border-theme-500'
              }`}
          >
            {item.checked && <Icon name="check" size={14} />}
          </button>

          {/* ÌÖçÏä§Ìä∏ */}
          {isEditing ? (
            <input
              ref={inputRef}
              type="text"
              value={editText}
              onChange={(e) => setEditText(e.target.value)}
              onBlur={handleSave}
              onKeyDown={(e) => {
                if (e.key === 'Enter') handleSave();
                if (e.key === 'Escape') { setEditText(item.text); setIsEditing(false); }
              }}
              className="flex-1 bg-theme-50 border-2 border-theme-300 rounded-xl px-3 py-2 text-primary focus:ring-0 focus:border-theme-400"
            />
          ) : (
            <span
              className={`flex-1 font-medium cursor-pointer ${item.checked ? 'line-through text-secondary' : 'text-primary'}`}
              onDoubleClick={() => !item.checked && setIsEditing(true)}
            >
              {item.text}
            </span>
          )}

          {/* ÏàòÏ†ï/ÏÇ≠Ï†ú Î≤ÑÌäº */}
          <button
            onClick={() => setIsEditing(true)}
            className="p-2 bg-theme-100 text-theme-600 hover:bg-theme-200 rounded-lg transition-all hover:scale-110"
          >
            <Icon name="pencil" size={14} />
          </button>
          <button
            onClick={() => setShowDeleteConfirm(true)}
            className="p-2 bg-red-100 text-red-600 hover:bg-red-200 rounded-lg transition-all hover:scale-110"
          >
            <Icon name="minus" size={14} />
          </button>
        </div>
      );
    };

    // Îã¨Î†• Ïª¥Ìè¨ÎÑåÌä∏
    const CalendarView = ({ posts, settings, dDay, onSelectPost, getMoodInfo, calendarNotes, setCalendarNotes }) => {
      const [currentMonth, setCurrentMonth] = useState(new Date());
      const [showYearMonthPicker, setShowYearMonthPicker] = useState(false);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [selectedDate, setSelectedDate] = useState(null);
      const [isAddingMemo, setIsAddingMemo] = useState(false);
      const [editingMemo, setEditingMemo] = useState(null);
      const [memoTitle, setMemoTitle] = useState('');
      const [memoColor, setMemoColor] = useState('#007AFF');
      const [isRecurringMemo, setIsRecurringMemo] = useState(false);
      const [touchStartX, setTouchStartX] = useState(0);
      const [touchEndX, setTouchEndX] = useState(0);
      const [isSettingsOpen, setIsSettingsOpen] = useState(false);
      const [moodStamps, setMoodStamps] = useState(() => {
        const saved = localStorage.getItem('coupleApp_moodStamps');
        return saved ? JSON.parse(saved) : {};
      });

      useEffect(() => {
        localStorage.setItem('coupleApp_moodStamps', JSON.stringify(moodStamps));
      }, [moodStamps]);

      // Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ
      const handleBackup = () => {
        const data = {
          posts: localStorage.getItem('coupleApp_data'),
          settings: localStorage.getItem('coupleApp_settings'),
          notes: localStorage.getItem('coupleApp_calendarNotes'),
          checklist: localStorage.getItem('coupleApp_checklist'),
          bucketList: localStorage.getItem('coupleApp_bucketList'),
          postColors: localStorage.getItem('coupleApp_postColors'),
          theme: localStorage.getItem('coupleApp_theme'),
          moodStamps: localStorage.getItem('coupleApp_moodStamps'),
          timestamp: new Date().toISOString()
        };

        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `couple_app_backup_${new Date().toISOString().slice(0, 10)}.json`;
        a.click();
        URL.revokeObjectURL(url);
        setIsSettingsOpen(false);
      };

      // Îç∞Ïù¥ÌÑ∞ Î≥µÏõê
      const handleRestore = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            if (data.posts) localStorage.setItem('coupleApp_data', data.posts);
            if (data.settings) localStorage.setItem('coupleApp_settings', data.settings);
            if (data.notes) localStorage.setItem('coupleApp_calendarNotes', data.notes);
            if (data.checklist) localStorage.setItem('coupleApp_checklist', data.checklist);
            if (data.bucketList) localStorage.setItem('coupleApp_bucketList', data.bucketList);
            if (data.postColors) localStorage.setItem('coupleApp_postColors', data.postColors);
            if (data.theme) localStorage.setItem('coupleApp_theme', data.theme);
            if (data.moodStamps) localStorage.setItem('coupleApp_moodStamps', data.moodStamps);

            alert('Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î≥µÏõêÎêòÏóàÏäµÎãàÎã§. Ïï±ÏùÑ Ïû¨ÏãúÏûëÌï©ÎãàÎã§.');
            window.location.reload();
          } catch (err) {
            alert('Î∞±ÏóÖ ÌååÏùº ÌòïÏãùÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.');
          }
        };
        reader.readAsText(file);
        setIsSettingsOpen(false);
      };

      const [postColors, setPostColors] = useState(() => {
        const saved = localStorage.getItem('coupleApp_postColors');
        return saved ? JSON.parse(saved) : {};
      });

      const MEMO_COLORS = ['#007AFF', '#34C759', '#FF9500', '#FF3B30', '#AF52DE', '#5856D6', '#FF2D55', '#00C7BE'];

      // postColors Ï†ÄÏû•
      useEffect(() => {
        localStorage.setItem('coupleApp_postColors', JSON.stringify(postColors));
      }, [postColors]);

      // Í≤åÏãúÍ∏Ä ÏÉâÏÉÅ Î≥ÄÍ≤Ω
      const setPostColor = (postId, color) => {
        setPostColors(prev => ({ ...prev, [postId]: color }));
      };

      // Í≤åÏãúÍ∏Ä ÏÉâÏÉÅ Í∞ÄÏ†∏Ïò§Í∏∞
      const getPostColor = (postId) => postColors[postId] || '#f472b6';

      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      const prevMonth = () => setCurrentMonth(new Date(year, month - 1, 1));
      const nextMonth = () => setCurrentMonth(new Date(year, month + 1, 1));

      // Ïä§ÏôÄÏù¥ÌîÑ Ìï∏Îì§Îü¨ (Touch + Mouse)
      const handleTouchStart = (e) => setTouchStartX(e.targetTouches[0].clientX);
      const handleTouchMove = (e) => setTouchEndX(e.targetTouches[0].clientX);
      const handleTouchEnd = () => {
        if (!touchStartX || !touchEndX) return;
        const distance = touchStartX - touchEndX;
        if (distance > 50) nextMonth();
        if (distance < -50) prevMonth();
        setTouchStartX(0);
        setTouchEndX(0);
      };

      const handleMouseDown = (e) => {
        setTouchStartX(e.clientX);
        setTouchEndX(0); // Ï¥àÍ∏∞Ìôî
      };

      const handleMouseUp = (e) => {
        if (!touchStartX) return;
        const touchEndX = e.clientX;
        const distance = touchStartX - touchEndX;
        if (distance > 50) nextMonth();
        if (distance < -50) prevMonth();
        setTouchStartX(0); // Reset
      };

      // ÎÇ†Ïßú ÌÅ¥Î¶≠ -> Î™®Îã¨ Ïó¥Í∏∞
      const handleDayClick = (day) => {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        setSelectedDate(dateStr);
        setIsModalOpen(true);
        setIsAddingMemo(false);
        setEditingMemo(null);
        setMemoTitle('');
        setIsRecurringMemo(false);
      };

      // Î©îÎ™® Í∞ÄÏ†∏Ïò§Í∏∞ (Î∞òÎ≥µ ÏùºÏ†ï Ìè¨Ìï®)
      const getMemosForDate = (dateStr) => {
        if (!dateStr) return [];
        let result = [];
        const notesData = calendarNotes || {};
        const data = notesData[dateStr];
        // 1. Ìï¥Îãπ ÎÇ†Ïßú Í≥†Ïú† Î©îÎ™®
        if (data) {
          if (Array.isArray(data)) result = [...data];
          else if (typeof data === 'string') result.push({ id: 1, title: data, color: '#007AFF' });
          else if (data.text) result.push({ id: 1, title: data.text, color: data.color || '#007AFF' });
        }
        // 2. Î∞òÎ≥µ ÏùºÏ†ï Í≤ÄÏÉâ
        const [y, m, d] = dateStr.split('-');
        const targetMD = `${m}-${d}`;
        Object.entries(notesData).forEach(([key, notes]) => {
          if (Array.isArray(notes)) {
            notes.forEach(note => {
              if (note.isRecurring) {
                const [_, rm, rd] = key.split('-');
                if (key !== dateStr && `${rm}-${rd}` === targetMD) {
                  result.push({ ...note, isRecurringDisplay: true });
                }
              }
            });
          }
        });
        // ID Ï§ëÎ≥µ Ï†úÍ±∞
        return result.filter((v, i, a) => a.findIndex(t => t.id === v.id) === i);
      };

      // Í≤åÏãúÍ∏Ä Í∞ÄÏ†∏Ïò§Í∏∞
      const getPostsForDate = (dateStr) => {
        return posts.filter(p => p.date === dateStr);
      };

      // Î©îÎ™® Ï∂îÍ∞Ä
      const addMemo = () => {
        if (!memoTitle.trim() || !selectedDate) return;
        const memos = calendarNotes[selectedDate] && Array.isArray(calendarNotes[selectedDate]) ? calendarNotes[selectedDate] : [];
        const newMemo = {
          id: Date.now(),
          title: memoTitle.trim(),
          color: memoColor,
          isRecurring: isRecurringMemo
        };
        setCalendarNotes(prev => ({
          ...prev,
          [selectedDate]: [...memos, newMemo]
        }));
        setMemoTitle('');
        setMemoColor('#007AFF');
        setIsRecurringMemo(false);
        setIsAddingMemo(false);
      };

      // Î©îÎ™® ÏàòÏ†ï
      const updateMemo = () => {
        if (!editingMemo || !memoTitle.trim() || !selectedDate) return;
        // ÌòÑÏû¨ ÎÇ†Ïßú ÌÇ§Ïóê ÏûàÎäî Î©îÎ™®Îßå ÏàòÏ†ï (Î∞òÎ≥µÎêú ÌÉÄ ÎÇ†Ïßú Î©îÎ™®Îäî ÏùºÎã® Ï†úÏô∏)
        const memos = calendarNotes[selectedDate] && Array.isArray(calendarNotes[selectedDate]) ? calendarNotes[selectedDate] : [];
        const updated = memos.map(m => m.id === editingMemo.id ? {
          ...m,
          title: memoTitle.trim(),
          color: memoColor,
          isRecurring: isRecurringMemo
        } : m);
        setCalendarNotes(prev => ({ ...prev, [selectedDate]: updated }));
        setEditingMemo(null);
        setMemoTitle('');
        setMemoColor('#007AFF');
        setIsRecurringMemo(false);
      };

      // Î©îÎ™® ÏÇ≠Ï†ú
      const deleteMemo = (id) => {
        if (!selectedDate) return;
        const memos = getMemosForDate(selectedDate);
        const filtered = memos.filter(m => m.id !== id);
        setCalendarNotes(prev => {
          const next = { ...prev };
          if (filtered.length === 0) delete next[selectedDate];
          else next[selectedDate] = filtered;
          return next;
        });
      };

      const anniversaryDates = [
        { label: 'ÏãúÏûëÏùº', date: settings.anniversaryDate, emoji: 'üíï' },
        { label: '100Ïùº', date: new Date(new Date(settings.anniversaryDate).getTime() + 100 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10), emoji: 'üéÇ' },
        { label: '1Ï£ºÎÖÑ', date: new Date(new Date(settings.anniversaryDate).getTime() + 365 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10), emoji: 'üéâ' },
      ];

      const isAnniversary = (day) => {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        return anniversaryDates.find(a => a.date === dateStr);
      };

      const isToday = (day) => {
        const today = new Date();
        return today.getFullYear() === year && today.getMonth() === month && today.getDate() === day;
      };

      useEffect(() => {
        const handleScroll = () => setIsScrolled(window.scrollY > 20);
        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
      }, []);

      return (
        <>
          {/* Í∏∞ÎÖêÏùº Ïπ¥Îìú */}
          <div className="card-bg rounded-2xl p-5 border border-theme-100 mb-6">
            <h3 className="font-bold text-lg mb-3 flex items-center gap-2">üíï Ïö∞Î¶¨Ïùò Í∏∞ÎÖêÏùº</h3>
            <div className="grid grid-cols-3 gap-3">
              {[
                { label: 'ÏãúÏûëÏùº', d: dDay, icon: 'heart' },
                { label: '100Ïùº', d: 100 - dDay, icon: 'cake' },
                { label: '1Ï£ºÎÖÑ', d: 365 - dDay, icon: 'gift' },
              ].map((item, i) => (
                <div key={i} className="bg-theme-50 rounded-xl p-3 text-center">
                  <Icon name={item.icon} size={20} className="mx-auto text-theme-500 mb-1" />
                  <p className="text-xs text-secondary">{item.label}</p>
                  <p className="font-bold text-theme-600 text-sm">
                    {item.d > 0 ? `D-${item.d}` : item.d === 0 ? 'Ïò§Îäò!' : `D+${Math.abs(item.d)}`}
                  </p>
                </div>
              ))}
            </div>
          </div>

          {/* Îã¨Î†• */}
          <div
            className="card-bg rounded-2xl shadow-sm border border-theme-100 overflow-hidden select-none"
            onTouchStart={handleTouchStart}
            onTouchMove={handleTouchMove}
            onTouchEnd={handleTouchEnd}
            onMouseDown={handleMouseDown}
            onMouseUp={handleMouseUp}
            onMouseLeave={() => setTouchStartX(0)}
          >
            {/* Ìó§Îçî */}
            <div className="flex items-center justify-between px-4 py-3 border-b border-theme-100">
              <button onClick={prevMonth} className="p-2 hover:bg-theme-100 rounded-full">
                <Icon name="chevron-left" size={20} className="text-secondary" />
              </button>
              <button
                onClick={() => setShowYearMonthPicker(!showYearMonthPicker)}
                className="font-semibold text-lg text-primary"
              >
                {year}ÎÖÑ {month + 1}Ïõî
              </button>
              <div className="flex items-center gap-1">
                <button onClick={nextMonth} className="p-2 hover:bg-theme-100 rounded-full">
                  <Icon name="chevron-right" size={20} className="text-secondary" />
                </button>
                {/* ÏÑ§Ï†ï Î©îÎâ¥ */}
                <div className="relative">
                  <button onClick={() => setIsSettingsOpen(!isSettingsOpen)} className="p-2 hover:bg-theme-100 rounded-full">
                    <Icon name="settings" size={20} className="text-secondary" />
                  </button>
                  {isSettingsOpen && (
                    <div className="absolute top-full right-0 mt-2 card-bg border border-theme-100 rounded-xl shadow-xl z-50 min-w-[180px] p-2 animate-scaleIn">
                      <button onClick={handleBackup} className="w-full text-left px-3 py-2 rounded-lg hover:bg-theme-50 text-primary text-sm flex items-center gap-2">
                        <Icon name="download" size={16} /> Î∞±ÏóÖ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                      </button>
                      <label className="w-full text-left px-3 py-2 rounded-lg hover:bg-theme-50 text-primary text-sm flex items-center gap-2 cursor-pointer">
                        <Icon name="upload" size={16} /> Î∞±ÏóÖ Î∂àÎü¨Ïò§Í∏∞
                        <input type="file" accept=".json" onChange={handleRestore} className="hidden" />
                      </label>
                    </div>
                  )}
                </div>
              </div>
            </div>

            {/* ÏöîÏùº */}
            <div className="grid grid-cols-7 border-b border-theme-100">
              {['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'].map((d, i) => (
                <div key={d} className={`text-center text-xs font-medium py-2 ${i === 0 ? 'text-red-400' : i === 6 ? 'text-blue-400' : 'text-secondary'}`}>
                  {d}
                </div>
              ))}
            </div>

            {/* ÎÇ†Ïßú Í∑∏Î¶¨Îìú */}
            <div className="grid grid-cols-7">
              {Array.from({ length: firstDay }, (_, i) => <div key={`e-${i}`} className="aspect-square" />)}
              {Array.from({ length: daysInMonth }, (_, i) => {
                const day = i + 1;
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const memos = getMemosForDate(dateStr);
                const dayPosts = getPostsForDate(dateStr);
                const today = isToday(day);
                const dayOfWeek = (firstDay + i) % 7;
                const totalItems = memos.length + dayPosts.length;
                const moodId = moodStamps && moodStamps[dateStr];
                const moodObj = moodId ? MOOD_OPTIONS.find(m => m.id === moodId) : null;

                return (
                  <button
                    key={day}
                    onClick={() => handleDayClick(day)}
                    className="aspect-square flex flex-col items-center justify-center relative cal-cell hover:bg-theme-100"
                  >
                    <span className={`text-sm text-primary p-1 rounded-full w-7 h-7 flex items-center justify-center ${today ? 'bg-theme-500 text-white' : ''} ${!today && dayOfWeek === 0 ? 'text-red-400' : ''} ${!today && dayOfWeek === 6 ? 'text-blue-400' : ''}`}>
                      {day}
                    </span>
                    {moodObj ? (
                      <div className={`absolute top-1 right-1 ${moodObj.color}`}>
                        <Icon name={moodObj.icon} size={12} />
                      </div>
                    ) : (
                      moodId && <span className="absolute top-1 right-1 text-[10px] sm:text-xs">{moodId}</span>
                    )}
                    {/* ÏïÑÏù¥ÌÖú ÌëúÏãú (Î©îÎ™® ÏÉâÏÉÅ + Í≤åÏãúÍ∏Ä) */}
                    {totalItems > 0 && (
                      <div className="flex flex-wrap gap-0.5 mt-0.5 justify-center max-w-full px-1">
                        {memos.map((m, idx) => (
                          <div key={idx} className="w-1.5 h-1.5 rounded-full" style={{ backgroundColor: m.color || '#007AFF' }} />
                        ))}
                        {dayPosts.map((p, idx) => (
                          <div key={`p-${idx}`} className="w-1.5 h-1.5 rounded-full" style={{ backgroundColor: getPostColor(p.id) }} />
                        ))}
                      </div>
                    )}
                  </button>
                );
              })}
            </div>
          </div>

          {/* ÏÉÅÏÑ∏ Î™®Îã¨ */}
          {isModalOpen && selectedDate && (
            <div className="fixed inset-0 z-50 flex items-center justify-center p-4" onClick={() => setIsModalOpen(false)}>
              <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" />
              <div className="relative card-bg rounded-2xl shadow-2xl p-5 w-full max-w-sm max-h-[80vh] overflow-y-auto border border-theme-100" onClick={(e) => e.stopPropagation()}>
                {/* Ìó§Îçî */}
                <div className="flex items-center justify-between mb-4">
                  <h3 className="font-bold text-lg text-primary">
                    {new Date(selectedDate).toLocaleDateString('ko-KR', { month: 'long', day: 'numeric', weekday: 'long' })}
                  </h3>
                  <button onClick={() => setIsModalOpen(false)} className="p-2 hover:bg-theme-100 rounded-full">
                    <Icon name="x" size={20} className="text-secondary" />
                  </button>
                </div>

                {/* Ïò§ÎäòÏùò Í∏∞Î∂Ñ Ïä§ÌÉ¨ÌîÑ */}
                <div className="mb-6 border-b border-theme-100 pb-4">
                  <h4 className="font-semibold text-primary text-sm mb-3 flex items-center gap-2">
                    <Icon name="smile" size={16} /> Ïò§ÎäòÏùò Í∏∞Î∂Ñ
                  </h4>
                  <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                    {MOOD_OPTIONS.map(mood => {
                      const isSelected = moodStamps[selectedDate] === mood.id;
                      return (
                        <button key={mood.id} onClick={() => setMoodStamps(prev => {
                          if (prev[selectedDate] === mood.id) {
                            const next = { ...prev };
                            delete next[selectedDate];
                            return next;
                          }
                          return { ...prev, [selectedDate]: mood.id };
                        })}
                          className={`flex-shrink-0 flex flex-col items-center justify-center min-w-[3.5rem] h-14 rounded-2xl border transition-all ${isSelected ? `${mood.bg} ${mood.color} border-current ring-1 ring-current shadow-sm` : 'border-transparent bg-gray-50 text-gray-400 hover:bg-gray-100 hover:text-gray-500'}`}>
                          <Icon name={mood.icon} size={20} className="mb-0.5" />
                          <span className="text-[10px] font-bold">{mood.label}</span>
                        </button>
                      );
                    })}
                  </div>
                </div>

                {/* Î©îÎ™® ÏÑπÏÖò */}
                <div className="mb-6">
                  <div className="flex items-center justify-between mb-3">
                    <h4 className="font-semibold text-primary flex items-center gap-2">
                      <Icon name="file-text" size={16} /> Î©îÎ™® ({getMemosForDate(selectedDate).length})
                    </h4>
                    <button
                      onClick={() => { setIsAddingMemo(true); setMemoTitle(''); setMemoColor('#007AFF'); }}
                      className="text-sm text-theme-500 font-medium"
                    >+ Ï∂îÍ∞Ä</button>
                  </div>

                  {/* Î©îÎ™® Ï∂îÍ∞Ä/ÏàòÏ†ï Ìèº */}
                  {(isAddingMemo || editingMemo) && (
                    <div className="mb-3 p-3 rounded-xl border border-theme-200 bg-theme-50">
                      <input
                        type="text"
                        value={memoTitle}
                        onChange={(e) => setMemoTitle(e.target.value)}
                        placeholder="Î©îÎ™® ÎÇ¥Ïö©..."
                        className="w-full px-3 py-2 border border-theme-200 rounded-lg text-sm mb-2 bg-white text-gray-800"
                        autoFocus
                        onKeyDown={(e) => e.key === 'Enter' && (editingMemo ? updateMemo() : addMemo())}
                      />
                      <div className="flex items-center gap-2 mb-2">
                        <span className="text-xs text-secondary">ÏÉâÏÉÅ:</span>
                        {MEMO_COLORS.map(c => (
                          <button
                            key={c}
                            onClick={() => setMemoColor(c)}
                            className={`w-5 h-5 rounded-full transition-transform ${memoColor === c ? 'ring-2 ring-offset-1 ring-theme-400 scale-110' : ''}`}
                            style={{ backgroundColor: c }}
                          />
                        ))}
                      </div>
                      <div className="flex items-center gap-2 mb-3">
                        <input
                          type="checkbox"
                          id="recurring"
                          checked={isRecurringMemo}
                          onChange={(e) => setIsRecurringMemo(e.target.checked)}
                          className="rounded border-theme-300 text-theme-500 focus:ring-theme-500"
                        />
                        <label htmlFor="recurring" className="text-xs text-secondary cursor-pointer select-none flex items-center gap-1">
                          <Icon name="rotate-cw" size={12} /> Îß§ÎÖÑ Î∞òÎ≥µ
                        </label>
                      </div>
                      <div className="flex gap-2">
                        <button onClick={editingMemo ? updateMemo : addMemo} className="flex-1 py-2 bg-theme-500 text-white rounded-lg text-sm font-medium">
                          {editingMemo ? 'ÏàòÏ†ï' : 'Ï∂îÍ∞Ä'}
                        </button>
                        <button onClick={() => { setIsAddingMemo(false); setEditingMemo(null); }} className="px-3 py-2 text-secondary text-sm">Ï∑®ÏÜå</button>
                      </div>
                    </div>
                  )}

                  {/* Î©îÎ™® Î™©Î°ù */}
                  <div className="space-y-2">
                    {getMemosForDate(selectedDate).map(memo => (
                      <div key={memo.id} className="p-3 rounded-lg flex items-center justify-between group" style={{ backgroundColor: memo.color + '20', borderLeft: `3px solid ${memo.color}` }}>
                        <span className="text-sm text-primary flex items-center gap-1">
                          {memo.title}
                          {(memo.isRecurring || memo.isRecurringDisplay) && <Icon name="rotate-cw" size={10} className="text-secondary" />}
                        </span>
                        <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                          <button onClick={() => { setEditingMemo(memo); setMemoTitle(memo.title); setMemoColor(memo.color || '#007AFF'); setIsAddingMemo(false); }} className="p-1 hover:bg-white/50 rounded">
                            <Icon name="pencil" size={12} className="text-secondary" />
                          </button>
                          <button onClick={() => deleteMemo(memo.id)} className="p-1 hover:bg-white/50 rounded">
                            <Icon name="trash-2" size={12} className="text-red-400" />
                          </button>
                        </div>
                      </div>
                    ))}
                    {getMemosForDate(selectedDate).length === 0 && !isAddingMemo && (
                      <p className="text-center text-secondary text-sm py-3">Î©îÎ™®Í∞Ä ÏóÜÏäµÎãàÎã§</p>
                    )}
                  </div>
                </div>

                {/* Í≤åÏãúÍ∏Ä ÏÑπÏÖò */}
                <div>
                  <h4 className="font-semibold text-primary flex items-center gap-2 mb-3">
                    <Icon name="image" size={16} className="text-pink-400" /> Í≤åÏãúÍ∏Ä ({getPostsForDate(selectedDate).length})
                  </h4>
                  <div className="space-y-2">
                    {getPostsForDate(selectedDate).map(post => (
                      <div key={post.id} className="p-3 rounded-lg flex items-center gap-3" style={{ backgroundColor: getPostColor(post.id) + '20', borderLeft: `3px solid ${getPostColor(post.id)}` }}>
                        <button onClick={() => { onSelectPost(post); setIsModalOpen(false); }} className="flex items-center gap-3 flex-1 min-w-0 text-left">
                          {post.media[0] && <img src={post.media[0].url} className="w-10 h-10 rounded-lg object-cover" alt="" />}
                          <div className="flex-1 min-w-0">
                            <p className="text-sm text-primary truncate">{post.content}</p>
                          </div>
                        </button>
                        {/* ÏÉâÏÉÅ ÏÑ†ÌÉù */}
                        <div className="flex gap-0.5">
                          {MEMO_COLORS.slice(0, 4).map(c => (
                            <button
                              key={c}
                              onClick={() => setPostColor(post.id, c)}
                              className={`w-4 h-4 rounded-full transition-transform ${getPostColor(post.id) === c ? 'ring-1 ring-offset-1 ring-gray-400 scale-110' : ''}`}
                              style={{ backgroundColor: c }}
                            />
                          ))}
                        </div>
                      </div>
                    ))}
                    {getPostsForDate(selectedDate).length === 0 && (
                      <p className="text-center text-secondary text-sm py-3">Í≤åÏãúÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§</p>
                    )}
                  </div>
                </div>
              </div>
            </div>
          )}
        </>
      );
    };

    // Ïù¥ÎØ∏ÏßÄ ÌôïÎåÄ Î∑∞Ïñ¥
    const ImageZoom = ({ src, onClose }) => (
      <div className="fixed inset-0 z-[60] flex items-center justify-center p-4" onClick={onClose}>
        <div className="absolute inset-0 bg-black/90" />
        <img
          src={src}
          className="relative max-w-full max-h-full object-contain animate-scaleIn"
          alt=""
          onClick={(e) => e.stopPropagation()}
        />
        <button
          onClick={onClose}
          className="absolute top-4 right-4 w-12 h-12 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center text-white btn-bounce"
        >
          <Icon name="x" size={24} />
        </button>
        <p className="absolute bottom-4 left-1/2 -translate-x-1/2 text-white/70 text-sm">ÌÅ¥Î¶≠ÌïòÏó¨ Îã´Í∏∞</p>
      </div>
    );

    const EmptyState = ({ onAdd }) => (
      <div className="card-bg border-2 border-dashed border-theme-200 rounded-[2.5rem] py-16 px-8 text-center flex flex-col items-center gap-5 animate-scaleIn">
        <div className="w-20 h-20 gradient-theme rounded-3xl flex items-center justify-center shadow-theme animate-float">
          <span className="text-4xl">üíï</span>
        </div>
        <div>
          <h3 className="text-xl font-bold text-primary mb-2">ÏïÑÏßÅ Í∏∞Î°ùÏù¥ ÏóÜÎÑ§Ïöî!</h3>
          <p className="text-secondary text-sm">ÏÜåÏ§ëÌïú Ï≤´ Î≤àÏß∏ Ï∂îÏñµÏùÑ ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî.</p>
        </div>
        <button onClick={onAdd} className="gradient-theme px-6 py-3 rounded-xl font-bold shadow-theme btn-bounce flex items-center gap-2 btn-primary-text">
          <Icon name="plus" size={18} /> Í∏∞Î°ù ÏãúÏûëÌïòÍ∏∞
        </button>
      </div>
    );

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>

</html>